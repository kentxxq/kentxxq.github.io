<!doctype html><html lang=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-131319987-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-131319987-1')</script><meta name=author content="kentxxq"><meta name=keywords content="k8s Azure 微软 kubectl kubernetes"><meta name=description content="我现在服务器上的微信，博客笔记，redis等等服务都是用的docker部署。在之前写过[部署web服务（可拓展）](https://kentxxq.com/contents/%E9%83%A8%E7%BD%B2web%E6%9C%8D%E5%8A%A1%E5%8F%AF%E6%8B%93%E5%B1%95/)，从现在的观点来看，还是比较落伍的，几乎没有自动化。代码部署/系统维护等等的问题没有考虑进去。而docker就解决了这些问题。而k8s则是docker在企业实践中的事实标准。我就用大白话来说说自己的理解和使用吧。"><meta property="og:title" content="我的k8s之路1-基本概念"><meta property="og:description" content="我现在服务器上的微信，博客笔记，redis等等服务都是用的docker部署。在之前写过[部署web服务（可拓展）](https://kentxxq.com/contents/%E9%83%A8%E7%BD%B2web%E6%9C%8D%E5%8A%A1%E5%8F%AF%E6%8B%93%E5%B1%95/)，从现在的观点来看，还是比较落伍的，几乎没有自动化。代码部署/系统维护等等的问题没有考虑进去。而docker就解决了这些问题。而k8s则是docker在企业实践中的事实标准。我就用大白话来说说自己的理解和使用吧。"><meta property="og:type" content="article"><meta property="og:url" content="https://kentxxq.com/contents/%E6%88%91%E7%9A%84k8s%E4%B9%8B%E8%B7%AF1-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-07-04T11:08:00+08:00"><meta property="article:modified_time" content="2021-02-26T00:06:04+08:00"><link rel=prev href=https://kentxxq.com/contents/aspnetcore%E7%9A%84%E5%88%9D%E6%AD%A5%E4%BA%86%E8%A7%A3/><link rel=next href=https://kentxxq.com/contents/%E8%B5%B7%E7%A0%81%E8%A6%81%E8%83%BD%E7%9C%8B%E6%87%82c%E7%B3%BB%E5%88%97%E7%9A%84%E4%BB%A3%E7%A0%81/><link rel=canonical href=https://kentxxq.com/contents/%E6%88%91%E7%9A%84k8s%E4%B9%8B%E8%B7%AF1-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=icon type=image/png href=/favicon.png><title>我的k8s之路1-基本概念 | kentxxq Blog</title><meta name=title content="我的k8s之路1-基本概念 | kentxxq Blog"><link rel=stylesheet href=/font/iconfont.css><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","image":"https:\/\/kentxxq.com\/images/me/avatar.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kentxxq.com\/"},"articleSection":"posts","name":"我的k8s之路1-基本概念","headline":"我的k8s之路1-基本概念","description":"我现在服务器上的微信，博客笔记，redis等等服务都是用的docker部署。在之前写过[部署web服务（可拓展）](https:\/\/kentxxq.com\/contents\/%E9%83%A8%E7%BD%B2web%E6%9C%8D%E5%8A%A1%E5%8F%AF%E6%8B%93%E5%B1%95\/)，从现在的观点来看，还是比较落伍的，几乎没有自动化。代码部署\/系统维护等等的问题没有考虑进去。而docker就解决了这些问题。而k8s则是docker在企业实践中的事实标准。我就用大白话来说说自己的理解和使用吧。","inLanguage":"zh","author":"kentxxq","creator":"kentxxq","publisher":{"@type":"Organization","name":"kentxxq","logo":{"@type":"ImageObject","url":"https:\/\/kentxxq.com\/images/me/avatar.jpg"}},"accountablePerson":"kentxxq","copyrightHolder":"kentxxq","copyrightYear":"2019","datePublished":"2019-07-04 11:08:00","dateModified":"2021-02-26 00:06:04","url":"https:\/\/kentxxq.com\/contents\/%E6%88%91%E7%9A%84k8s%E4%B9%8B%E8%B7%AF1-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5\/","keywords":["k8s","Azure","微软","kubectl","kubernetes"]}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://kentxxq.com/>kentxxq Blog</a></div><div class="menu navbar-right"><a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/about/ title>About</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://kentxxq.com/>kentxxq Blog</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/about/ title>About</a></div></div></nav><main class=main><div class=container><article class=post-warp><header class=post-header><h1 class=post-title>我的k8s之路1-基本概念</h1><div class=post-meta>Written by <a href=https://kentxxq.com/ rel=author>kentxxq</a>
with ♥
<span class=post-time>on <time datetime=2019-07-04>July 4, 2019</time></span>
in
<i class="iconfont icon-folder"></i>
<span class=post-category><a href=https://kentxxq.com/categories/%E7%AC%94%E8%AE%B0/>笔记</a></span>
|
<a href=#gitalk-container><span class=gitalk-comment-count itemprop=commentCount></span></a></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title></h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#关于k8s>关于k8s</a></li><li><a href=#概念>概念</a><ul><li><a href=#pod>Pod</a></li><li><a href=#service>Service</a></li><li><a href=#volume>Volume</a></li><li><a href=#lable>Lable</a></li><li><a href=#deployment>Deployment</a></li><li><a href=#statefulset>StatefulSet</a></li><li><a href=#job>Job</a></li><li><a href=#示例>示例</a></li></ul></li><li><a href=#操作上手>操作上手</a><ul><li><a href=#创建k8s集群>创建k8s集群</a></li><li><a href=#kubectl操作>kubectl操作</a></li></ul></li><li><a href=#总结>总结</a></li><li><a href=#更新>更新</a></li></ul></nav></div></div><script type=text/javascript>window.onload=function(){var a=$('.post-toc'),b=$('.post-comment'),f=a.offset().top,d=a.height(),g=a[0].offsetTop,e,c;$(window).scroll(function(){var h=Math.max(document.body.scrollTop,document.documentElement.scrollTop);b.length>0&&(c=b.offset().top,e=c-h-d),f<h?(a.css({position:'fixed'}),b.length>0&&c<h+d?a.css({top:e}):a.css({top:0})):(a.css({position:'absolute'}),a.css({top:g}))})}</script><div class=post-content><blockquote><p>我现在服务器上的微信，博客笔记，redis等等服务都是用的docker部署。在之前写过<a href=https://kentxxq.com/contents/%E9%83%A8%E7%BD%B2web%E6%9C%8D%E5%8A%A1%E5%8F%AF%E6%8B%93%E5%B1%95/>部署web服务（可拓展）</a>，从现在的观点来看，还是比较落伍的，几乎没有自动化。代码部署/系统维护等等的问题没有考虑进去。而docker就解决了这些问题。</p><p>而k8s则是docker在企业实践中的事实标准。</p><p>我就用大白话来说说自己的理解和使用吧。</p></blockquote><h2 id=关于k8s>关于k8s</h2><p>每当出现一个问题，就会出现对应的解决方法。下面是我个人的理解的简化版。</p><p><code>openstack</code>是把一堆硬件资源，整合到一起变成一台超级计算机。在此基础上，虚拟出各种资源。<strong>对硬件资源进行了整合。同时方便扩容。</strong></p><p><code>docker</code><strong>解决的是app应用的环境问题。</strong></p><p><code>k8s</code><strong>解决了docker编排，负载均衡，自动拓展等等问题。</strong></p><p>openstack是为了让vm无忧无虑的健康运行。k8s则是为你的docker提供完美的环境。</p><h2 id=概念>概念</h2><p>这里我仅列出来我暂时用到的概念。总不能一上来，把文档从头看到尾吧～</p><h3 id=pod>Pod</h3><p><code>Pod</code>是k8s的<strong>最小计算单元</strong>。最常用的情况就是一个docker容器（同时入门使用也推荐此用法）。</p><p>如果像是redis集群这样的应用，每个pod之间可以使用卷功能来进行共享数据。</p><p>通常在大型应用的场景下，docker的部署很多都是一台机器运行一个docker容器。</p><p>而如果你只有3个节点的k8s集群，你也可以运行3个以上的pod。虽然不推荐这样子，但是k8s首要目的是为了让你的部署方案能成功。</p><p>pod中的Controller通过Template来创建pod。</p><h3 id=service>Service</h3><p><code>Service</code>是pod的逻辑集合。<strong>对内进行pod的负载均衡。对外提供访问地址。</strong></p><h3 id=volume>Volume</h3><p><code>Volume</code>为pod提供<strong>共享数据卷</strong>。</p><h3 id=lable>Lable</h3><p><code>Lable</code>用来<strong>区分service/pod等资源</strong>。LableSelector用来service/pod之间的对应。</p><h3 id=deployment>Deployment</h3><p><code>Deployment</code>它<strong>管理ReplicaSets和Pod</strong>，并提供声明式更新等功能。</p><p>一个pod挂了，应用就挂了。而通过Deployment设置用几个pod来提供服务，确保应用正常运作。</p><ul><li>web应用</li><li>win10的激活可以自己搭建kms服务器。而并不需要数据库来存储任何信息。</li></ul><h3 id=statefulset>StatefulSet</h3><p><code>StatefulSet</code>用于<strong>持久性的应用程序</strong>，有唯一的网络标识符（IP），持久存储，有序的部署、扩展、删除和滚动更新。</p><ul><li>redis集群</li><li>部署应用后一键回滚，且不影响运行中的应用</li></ul><h3 id=job>Job</h3><p><code>Job</code>用来<strong>执行一次性的任务</strong>。可定时。</p><ul><li>比如开启100个pod来执行一个cpu密集型的应用。完了存到数据库以后，直接销毁。</li></ul><h3 id=示例>示例</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>azure-vote-back</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>azure-vote-back</span>
  <span style=color:#f92672>template</span>:
    <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>labels</span>:
        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>azure-vote-back</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>nodeSelector</span>:
        <span style=color:#f92672>&#34;beta.kubernetes.io/os&#34;: </span><span style=color:#ae81ff>linux</span>
      <span style=color:#f92672>containers</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>azure-vote-back</span>
        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>redis</span>
        <span style=color:#f92672>resources</span>:
          <span style=color:#f92672>requests</span>:
            <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>100m</span>
            <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>128Mi</span>
          <span style=color:#f92672>limits</span>:
            <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>250m</span>
            <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>256Mi</span>
        <span style=color:#f92672>ports</span>:
        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>6379</span>
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>redis</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>azure-vote-back</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>ports</span>:
  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>6379</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>azure-vote-back</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>azure-vote-front</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>azure-vote-front</span>
  <span style=color:#f92672>template</span>:
    <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>labels</span>:
        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>azure-vote-front</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>nodeSelector</span>:
        <span style=color:#f92672>&#34;beta.kubernetes.io/os&#34;: </span><span style=color:#ae81ff>linux</span>
      <span style=color:#f92672>containers</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>azure-vote-front</span>
        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>microsoft/azure-vote-front:v1</span>
        <span style=color:#f92672>resources</span>:
          <span style=color:#f92672>requests</span>:
            <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>100m</span>
            <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>128Mi</span>
          <span style=color:#f92672>limits</span>:
            <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>250m</span>
            <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>256Mi</span>
        <span style=color:#f92672>ports</span>:
        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
        <span style=color:#f92672>env</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>REDIS</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;azure-vote-back&#34;</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>azure-vote-front</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>LoadBalancer</span>
  <span style=color:#f92672>ports</span>:
  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>azure-vote-front</span>
</code></pre></div><h2 id=操作上手>操作上手</h2><p>其实这不是我第一次使用云厂商的k8s服务。第一次用的是华为云。而这一次用Azure来试试。体验一下不同点和共同点。日后也方便自己选择平台。</p><p>Azure有专门的命令行工具。可以帮助你快速操作Azure，包括管理你的k8s集群。</p><h3 id=创建k8s集群>创建k8s集群</h3><p>aks是azure k8s service的简写。</p><p>这部分参考<a href=https://docs.microsoft.com/zh-cn/azure/aks/>官方文档</a>比较好。且非常简单。</p><h3 id=kubectl操作>kubectl操作</h3><p><code>kubectl</code>是一个让你连接到k8s集群的工具。</p><p>下面是一些常用的命令。你可以通过<code>kubectl help</code>或者<a href=https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands>参考kubectl官方文档</a></p><hr><p><code>kubectl get</code>获取简要信息。</p><p>获取k8s的运行中pods</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get pods
NAME                                READY   STATUS    RESTARTS   AGE
azure-vote-back-7fb47b8f6d-ls68j    1/1     Running   <span style=color:#ae81ff>0</span>          22h
azure-vote-front-7dbf9f5dfb-zv4wz   1/1     Running   <span style=color:#ae81ff>0</span>          22h
</code></pre></div><p>获取k8s的nodes节点</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get nodes
NAME                       STATUS   ROLES   AGE   VERSION
aks-agentpool-42416830-0   Ready    agent   24h   v1.12.8
aks-agentpool-42416830-1   Ready    agent   24h   v1.12.8
aks-agentpool-42416830-2   Ready    agent   24h   v1.12.8
aks-agentpool-42416830-3   Ready    agent   24h   v1.12.8
</code></pre></div><hr><p><code>kubectl describe</code>根据上面获得的name信息，可以通过查看deployment/pod/service/node等等详情。例如：</p><p><code>kubectl describe deployment azure-vote-back</code>:查看指定的deployment当前状态</p><hr><p><code>kubectl create -f xxx.yml</code>通过yml文件内的内容进行集群的创建。</p><hr><p><code>kubectl rolling-update</code>进行滚动更新。用来确保应用不中断运行。云厂商提供的滚动更新和灰度更新等等都基于此。</p><hr><p><code>kubectl autoscale</code>自动负载均衡。</p><hr><p><code>kubectl exec</code>进入pods，类似docker exec。</p><hr><p><code>kubectl cp</code>用来交互pod中的数据。</p><hr><p><code>kubectl cordon, drain, uncordon</code>把运行在某个node上的pods挪走，你便可以对node进行配置修改或者排错。</p><p>cordon先将node节点标记为不可再调度。drain挪走node节点上的pods等服务。uncordon恢复node为可调度状态。</p><hr><p><strong>就到这了。我也就不做官网的搬运工了。。</strong></p><h2 id=总结>总结</h2><p>不得不说的是，微软的文档是我见过最棒的。之前我见过别人说为什么java有那么多的开源库和方案，而c#很少？因为C#官方文档好，且都是官方自己做轮子，集成到了标准库。不需要了呀。</p><p>比如说json，java有fastjson/gson/jackson等等。。真的是头大。</p><h2 id=更新>更新</h2><p><strong>20200729</strong>: 准备把k8s写成一个系列，也方便我自己来回顾。。一看这个日志的时间是2019年7月写的，居然都一年了，我又来学。。要是早学好，现在也不用重复了。学习还是贵在坚持。就从现在开始呗。</p></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>kentxxq</span></p><p class=copyright-item><span>Link:</span>
<a href=https://kentxxq.com/contents/%E6%88%91%E7%9A%84k8s%E4%B9%8B%E8%B7%AF1-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/><script>document.write(decodeURI(location.origin+location.pathname))</script></a></p><p class="copyright-item lincese">本文采用<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p></div><div class=post-tags><section><i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://kentxxq.com/tags/k8s/>#k8s</a></span>
<span class=tag><a href=https://kentxxq.com/tags/azure/>#Azure</a></span></section><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://kentxxq.com/>home</a></span></section></div><div class=post-nav><a href=https://kentxxq.com/contents/aspnetcore%E7%9A%84%E5%88%9D%E6%AD%A5%E4%BA%86%E8%A7%A3/ class=prev rel=prev title=AspNetCore的初步了解><i class="iconfont icon-left"></i>&nbsp;AspNetCore的初步了解</a>
<a href=https://kentxxq.com/contents/%E8%B5%B7%E7%A0%81%E8%A6%81%E8%83%BD%E7%9C%8B%E6%87%82c%E7%B3%BB%E5%88%97%E7%9A%84%E4%BB%A3%E7%A0%81/ class=next rel=next title=起码要能看懂c系列的代码>起码要能看懂c系列的代码&nbsp;<i class="iconfont icon-right"></i></a></div></article><div class=post-comment><div id=disqus_thread></div><script>var disqus_config=function(){this.page.title="我的k8s之路1-基本概念",this.page.url="https://kentxxq.com/contents/%E6%88%91%E7%9A%84k8s%E4%B9%8B%E8%B7%AF1-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"};(function(){var a=document,b=a.createElement('script');b.src='https://kentxxq.disqus.com/embed.js',b.setAttribute('data-timestamp',+new Date),(a.head||a.body).appendChild(b)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by
Disqus.</a></noscript></div></div></main><footer class=footer><a href=https://beian.miit.gov.cn/ target=_blank rel="external nofollow">湘ICP备2021002319号-1</a></footer><script src=/js/vendor_no_gallery.min.js async></script><script src=https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js></script></div></body></html>