<!doctype html><html lang=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-131319987-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-131319987-1')</script><meta name=author content="kentxxq"><meta name=keywords content="Centos7 grub2 timeout rufus UEFI BIOS GNOME sudo 内核 fdisk mkfs.xfs blkid"><meta name=description content="之前安装centos，都是在阿里云，虚拟机，还有hp-gen6-380的服务器上面安装。也就是说实体机的操作经验，只有一个比较老的hp服务器。而这次使用普通pc机来安装，遇到了不少的问题。重装了大概有50次以上吧，特意来记录一下"><meta property="og:title" content="记录一次实机安装Centos7"><meta property="og:description" content="之前安装centos，都是在阿里云，虚拟机，还有hp-gen6-380的服务器上面安装。也就是说实体机的操作经验，只有一个比较老的hp服务器。而这次使用普通pc机来安装，遇到了不少的问题。重装了大概有50次以上吧，特意来记录一下"><meta property="og:type" content="article"><meta property="og:url" content="https://kentxxq.com/contents/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%9C%BA%E5%AE%89%E8%A3%85centos7/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-04-15T11:59:00+08:00"><meta property="article:modified_time" content="2021-02-26T00:06:04+08:00"><link rel=prev href=https://kentxxq.com/contents/%E5%9C%A8mac%E4%B8%8Aheic%E8%BD%ACjpg%E6%88%96png/><link rel=next href=https://kentxxq.com/contents/%E7%94%B5%E5%BD%B1_%E7%87%95%E5%B0%BE%E8%9D%B6/><link rel=canonical href=https://kentxxq.com/contents/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%9C%BA%E5%AE%89%E8%A3%85centos7/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=icon type=image/png href=/favicon.png><title>记录一次实机安装Centos7 | kentxxq Blog</title><meta name=title content="记录一次实机安装Centos7 | kentxxq Blog"><link rel=stylesheet href=/font/iconfont.css><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","image":"https:\/\/kentxxq.com\/images/me/avatar.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kentxxq.com\/"},"articleSection":"posts","name":"记录一次实机安装Centos7","headline":"记录一次实机安装Centos7","description":"之前安装centos，都是在阿里云，虚拟机，还有hp-gen6-380的服务器上面安装。也就是说实体机的操作经验，只有一个比较老的hp服务器。而这次使用普通pc机来安装，遇到了不少的问题。重装了大概有50次以上吧，特意来记录一下","inLanguage":"zh","author":"kentxxq","creator":"kentxxq","publisher":{"@type":"Organization","name":"kentxxq","logo":{"@type":"ImageObject","url":"https:\/\/kentxxq.com\/images/me/avatar.jpg"}},"accountablePerson":"kentxxq","copyrightHolder":"kentxxq","copyrightYear":"2019","datePublished":"2019-04-15 11:59:00","dateModified":"2019-04-15 11:59:00","url":"https:\/\/kentxxq.com\/contents\/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%9C%BA%E5%AE%89%E8%A3%85centos7\/","keywords":["Centos7","grub2","timeout","rufus","UEFI","BIOS","GNOME","sudo","内核","fdisk","mkfs.xfs","blkid"]}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://kentxxq.com/>kentxxq Blog</a></div><div class="menu navbar-right"><a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/about/ title>About</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://kentxxq.com/>kentxxq Blog</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/about/ title>About</a></div></div></nav><main class=main><div class=container><article class=post-warp><header class=post-header><h1 class=post-title>记录一次实机安装Centos7</h1><div class=post-meta>Written by <a href=https://kentxxq.com/ rel=author>kentxxq</a>
with ♥
<span class=post-time>on <time datetime=2019-04-15>April 15, 2019</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=https://kentxxq.com/categories/%E7%AC%94%E8%AE%B0/>笔记</a></span>
|
<a href=#gitalk-container><span class=gitalk-comment-count itemprop=commentCount></span></a></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title></h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#安装经验>安装经验</a></li><li><a href=#遇到的问题>遇到的问题</a><ul><li><a href=#grub2-timeout问题>grub2-timeout问题</a></li><li><a href=#安装gnome桌面>安装GNOME桌面</a></li><li><a href=#开启远程桌面>开启远程桌面</a></li><li><a href=#自动挂载磁盘>自动挂载磁盘</a></li></ul></li><li><a href=#知识拓展>知识拓展</a><ul><li><a href=#efi和bios启动流程>efi和bios启动流程</a></li><li><a href=#验证efi还是bios>验证efi还是bios</a></li><li><a href=#指定用户sudo免密码>指定用户sudo免密码</a></li></ul></li><li><a href=#总结>总结</a></li></ul></nav></div></div><script type=text/javascript>window.onload=function(){var a=$('.post-toc'),b=$('.post-comment'),f=a.offset().top,d=a.height(),g=a[0].offsetTop,e,c;$(window).scroll(function(){var h=Math.max(document.body.scrollTop,document.documentElement.scrollTop);b.length>0&&(c=b.offset().top,e=c-h-d),f<h?(a.css({position:'fixed'}),b.length>0&&c<h+d?a.css({top:e}):a.css({top:0})):(a.css({position:'absolute'}),a.css({top:g}))})}</script><div class=post-content><blockquote><p>之前安装centos，都是在阿里云，虚拟机，还有hp-gen6-380的服务器上面安装。</p><p>也就是说实体机的操作经验，只有一个比较老的hp服务器。而这次使用普通pc机来安装，遇到了不少的问题。重装了大概有50次+吧，特意来记录一下。</p></blockquote><h2 id=安装经验>安装经验</h2><p>交代一下安装linux的经验</p><ol><li>阿里云，虚拟机(这两个都属于虚拟环境了)</li><li>hp-gen6-380(比较老的服务器机型)</li><li>家用e3v3+gpu750ti+华硕gaming主板(安装的是的fedora29，所有的组件都很新，问题也不少)</li></ol><p>而这次安装在普通pc上，却遇到了问题。让我觉得还是很有必要系统性的了解一下。</p><h2 id=遇到的问题>遇到的问题</h2><h3 id=grub2-timeout问题>grub2-timeout问题</h3><p>启动了开机按钮以后，一直卡住在这个界面，需要手动操作才能完成点击。</p><p><img src=/images/server/%E5%86%85%E6%A0%B8%E5%8D%A1%E4%BD%8F%E7%95%8C%E9%9D%A2.jpg alt=内核卡住界面></p><p>解决方案:</p><p>把超时时间设置为0，直接跳过内核选择界面。<strong>进入默认选中的第一个内核</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>### 路径</span>
<span style=color:#f92672>[</span>root@YHcentos7 default<span style=color:#f92672>]</span><span style=color:#75715e># pwd</span>
/etc/default
<span style=color:#75715e>### 查看配置文件</span>
<span style=color:#f92672>[</span>root@YHcentos7 default<span style=color:#f92672>]</span><span style=color:#75715e># cat grub </span>
GRUB_TIMEOUT<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
GRUB_DISTRIBUTOR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>sed <span style=color:#e6db74>&#39;s, release .*$,,g&#39;</span> /etc/system-release<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
GRUB_DEFAULT<span style=color:#f92672>=</span>saved
GRUB_DISABLE_SUBMENU<span style=color:#f92672>=</span>true
GRUB_TERMINAL_OUTPUT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;console&#34;</span>
GRUB_CMDLINE_LINUX<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;crashkernel=auto rhgb quiet&#34;</span>
GRUB_DISABLE_RECOVERY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span>
<span style=color:#75715e>### bios系统生成boot配置</span>
<span style=color:#f92672>[</span>root@YHcentos7 default<span style=color:#f92672>]</span><span style=color:#75715e># grub2-mkconfig -o /boot/grub2/grub.cfg</span>
GRUB_DISABLE_RECOVERY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span>
<span style=color:#75715e>### uefi系统生成boot配置</span>
<span style=color:#f92672>[</span>root@YHcentos7 default<span style=color:#f92672>]</span><span style=color:#75715e># grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg</span>
<span style=color:#75715e>### 重启</span>
<span style=color:#f92672>[</span>root@YHcentos7 default<span style=color:#f92672>]</span><span style=color:#75715e># reboot</span>
</code></pre></div><hr><p><strong>如果你想知道为什么不能启用timeout进入指定的内核，请看下面</strong></p><p>在重装了差不多5次以后，我其中的一次安装后，居然没有问题！导致我后续重装了大概50次，找到了原因。</p><p>我的u盘启动盘，是用<a href=https://rufus.ie/>rufus</a>制作的。用的<a href=https://www.centos.org/download/>centos</a>dvd版本的镜像。</p><p>插入u盘后，引导设备如下</p><p><img src=/images/server/%E4%B8%BB%E6%9D%BF%E5%BC%95%E5%AF%BC%E5%9B%BE.jpg alt=主板引导图></p><p>可以看到，除了128gb的硬盘，还有<strong>2个可选项</strong>！</p><p>选择第一个，也就是<code>UEFI启动</code>，在后续的系统分区中，你必须给<code>/boot/efi</code>指定分区。分区文件类型为efi。如果没有的话，会报错<code>no valid bootloader target device found centos 7 for a uefi installation</code></p><p>选择第三个，也就是<code>BIOS启动</code>，则可以不用建立/boot/efi分区，成功timeout后进入系统。</p><p>下图就是bios启动，安装系统后的分区结构。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>### sda2用做了swap</span>
<span style=color:#f92672>[</span>root@YHcentos7 ~<span style=color:#f92672>]</span><span style=color:#75715e># df -h</span>
文件系统        容量  已用  可用 已用% 挂载点
/dev/sda3       110G  4.0G  107G    4% /
devtmpfs        7.7G     <span style=color:#ae81ff>0</span>  7.7G    0% /dev
tmpfs           7.8G     <span style=color:#ae81ff>0</span>  7.8G    0% /dev/shm
tmpfs           7.8G  9.6M  7.7G    1% /run
tmpfs           7.8G     <span style=color:#ae81ff>0</span>  7.8G    0% /sys/fs/cgroup
/dev/sda1       497M  199M  298M   41% /boot
tmpfs           1.6G   12K  1.6G    1% /run/user/42
tmpfs           1.6G     <span style=color:#ae81ff>0</span>  1.6G    0% /run/user/0
</code></pre></div><p><code>UEFI启动</code>只能按照之前的办法来跳过(我没有找到解决办法)。</p><p><code>BIOS启动</code>则可以正常显示timeout，进入默认选中的内核。</p><h3 id=安装gnome桌面>安装GNOME桌面</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>### 安装命令</span>
yum groupinstall <span style=color:#e6db74>&#34;GNOME Desktop&#34;</span> -y
<span style=color:#75715e>### 切换系统环境</span>
<span style=color:#75715e># 开启桌面</span>
systemctl set-default graphical.target 
<span style=color:#75715e># 关闭桌面</span>
systemctl set-default multi-user.target 
<span style=color:#75715e># 切换桌面 3为命令行 5为桌面</span>
init <span style=color:#ae81ff>3</span> 
init <span style=color:#ae81ff>5</span>
<span style=color:#75715e>### 查看gnome版本</span>
yum list installed |grep gnome
<span style=color:#75715e>### 查看使用的是x window还是wayland</span>
<span style=color:#75715e># 查看已经登陆的session</span>
loginctl
<span style=color:#75715e># 把桌面的那个填到下面去即可</span>
loginctl show-session &lt;SESSION_ID&gt; -p Type
<span style=color:#75715e>### 卸载命令</span>
yum groupremove <span style=color:#e6db74>&#34;GNOME Desktop&#34;</span>
</code></pre></div><h3 id=开启远程桌面>开启远程桌面</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>### 安装xrdp</span>
yum -y install xrdp
<span style=color:#75715e>### 启动服务</span>
systemctl start xrdp.service
<span style=color:#75715e>### 验证端口</span>
netstat -ltn
<span style=color:#75715e>### 如果不能远程访问，关闭防火墙</span>
systemctl stop firewalld.service
</code></pre></div><h3 id=自动挂载磁盘>自动挂载磁盘</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>### fdisk分区硬盘后用xfs格式来格式化</span>
mkfs.xfs /dev/sdb1
<span style=color:#75715e>### 挂载到/data目录</span>
mkdir /data
mount /dev/sdb1 /data
<span style=color:#75715e>### 查看磁盘uuid</span>
blkid
<span style=color:#75715e>### 在/etc/fstab下加上这个</span>
UUID<span style=color:#f92672>=</span>15f87ab4-176a-46a3-bc07-60ef5f2a4129 /                       xfs     defaults        <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
UUID<span style=color:#f92672>=</span>adfb7be3-85ce-49c7-992b-e5a0f299f3dd swap                    swap    defaults        <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
UUID<span style=color:#f92672>=</span>cd51618b-2615-4d6e-9abc-3a091c8fb820 /data                   xfs     defaults        <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
<span style=color:#75715e>### 测试一下有没有问题</span>
mount -a
<span style=color:#75715e>### 没问题重启一下肯定也没问题了</span>
reboot
</code></pre></div><h2 id=知识拓展>知识拓展</h2><p><a href=https://www.gnu.org/software/grub/manual/grub/html_node/Simple-configuration.html>grub2的配置文档</a></p><h3 id=efi和bios启动流程>efi和bios启动流程</h3><p>Boot Process under BIOS</p><ol><li>System switched on - Power On Self Test, or POST process</li><li>After POST BIOS initializes the necessary system hardware for booting (disk, keyboard controllers etc.)BIOS launches the first 440 bytes (MBR boot code region) of the first disk in the BIOS disk order</li><li>The MBR boot code then takes control from BIOS and launches its next stage code (if any) (mostly bootloader code)</li><li>The launched (2nd stage) code (actual bootloader) then reads its support and config files</li><li>Based on the data in its config files, the bootloader loads the kernel and initramfs into system memory (RAM) and launches the kernel</li></ol><p>Boot Process under UEFI</p><ol><li>System switched on - Power On Self Test, or POST process.</li><li>UEFI firmware is loaded.</li><li>Firmware initializes the hardware required for booting.Firmware then reads its Boot Manager data to determine which UEFI application to be launched and from where (i.e. from which disk and partition).</li><li>Firmware then launches the UEFI application as defined in the boot entry in the firmware&rsquo;s boot manager.</li><li>The launched UEFI application may launch another application (in case of UEFI Shell or a boot manager like rEFInd) or the kernel and initramfs (in case of a bootloader like GRUB) depending on how the UEFI application was configured.</li></ol><h3 id=验证efi还是bios>验证efi还是bios</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>### 进入/sys/firmware</span>
cd /sys/firmware
<span style=color:#75715e>### 如果有efi文件夹，就是efi。否则就是bios</span>
</code></pre></div><h3 id=指定用户sudo免密码>指定用户sudo免密码</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>vi /etc/sudoers
<span style=color:#75715e>### 加到root用户下面</span>
your_user_name ALL<span style=color:#f92672>=(</span>ALL<span style=color:#f92672>)</span> NOPASSWD: ALL
</code></pre></div><h2 id=总结>总结</h2><p>UEFI可以有无限的分区。可以识别2TB以上的硬盘。</p><p>bios只能弄一个拓展分区，然后无限拓展。一旦上层出现错误，就会导致不可用。不过够用了。</p><p>以后专门的存储服务器，就用uefi来安装。反正也不需要升级什么的，直接关闭掉内核的选择。</p><p>bios的就通过nfs直接挂载存储服务器磁盘。</p></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>kentxxq</span></p><p class=copyright-item><span>Link:</span>
<a href=https://kentxxq.com/contents/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%9C%BA%E5%AE%89%E8%A3%85centos7/><script>document.write(decodeURI(location.origin+location.pathname))</script></a></p><p class="copyright-item lincese">本文采用<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p></div><div class=post-tags><section><i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://kentxxq.com/tags/centos/>#centos</a></span></section><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://kentxxq.com/>home</a></span></section></div><div class=post-nav><a href=https://kentxxq.com/contents/%E5%9C%A8mac%E4%B8%8Aheic%E8%BD%ACjpg%E6%88%96png/ class=prev rel=prev title=在mac上HEIC转JPG或PNG><i class="iconfont icon-left"></i>&nbsp;在mac上HEIC转JPG或PNG</a>
<a href=https://kentxxq.com/contents/%E7%94%B5%E5%BD%B1_%E7%87%95%E5%B0%BE%E8%9D%B6/ class=next rel=next title=电影_燕尾蝶>电影_燕尾蝶&nbsp;<i class="iconfont icon-right"></i></a></div></article><div class=post-comment><div id=disqus_thread></div><script>var disqus_config=function(){this.page.title="记录一次实机安装Centos7",this.page.url="https://kentxxq.com/contents/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E5%AE%9E%E6%9C%BA%E5%AE%89%E8%A3%85centos7/"};(function(){var a=document,b=a.createElement('script');b.src='https://kentxxq.disqus.com/embed.js',b.setAttribute('data-timestamp',+new Date),(a.head||a.body).appendChild(b)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by
Disqus.</a></noscript></div></div></main><footer class=footer><a href=https://beian.miit.gov.cn/ target=_blank rel="external nofollow">湘ICP备2021002319号-1</a></footer><link href=//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css rel=stylesheet><script src=/js/vendor_gallery.min.js async></script><script src=https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js></script></div></body></html>