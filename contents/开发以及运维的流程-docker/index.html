<!doctype html><html lang=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-131319987-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-131319987-1')</script><meta name=author content="kentxxq"><meta name=keywords content="server 流程 docker python pipenv wget centos nginx redis yum"><meta name=description content="开发以及运维的流程-docker"><meta property="og:title" content="开发以及运维的流程-docker"><meta property="og:description" content="开发以及运维的流程-docker"><meta property="og:type" content="article"><meta property="og:url" content="https://kentxxq.com/contents/%E5%BC%80%E5%8F%91%E4%BB%A5%E5%8F%8A%E8%BF%90%E7%BB%B4%E7%9A%84%E6%B5%81%E7%A8%8B-docker/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-01-03T00:00:00+08:00"><meta property="article:modified_time" content="2021-02-26T00:06:04+08:00"><link rel=prev href=https://kentxxq.com/contents/%E8%BD%AC%E5%88%B0hugo/><link rel=next href=https://kentxxq.com/contents/git%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/><link rel=canonical href=https://kentxxq.com/contents/%E5%BC%80%E5%8F%91%E4%BB%A5%E5%8F%8A%E8%BF%90%E7%BB%B4%E7%9A%84%E6%B5%81%E7%A8%8B-docker/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=icon type=image/png href=/favicon.png><title>开发以及运维的流程-docker | kentxxq Blog</title><meta name=title content="开发以及运维的流程-docker | kentxxq Blog"><link rel=stylesheet href=/font/iconfont.css><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","image":"https:\/\/kentxxq.com\/images/me/avatar.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kentxxq.com\/"},"articleSection":"posts","name":"开发以及运维的流程-docker","headline":"开发以及运维的流程-docker","description":"开发以及运维的流程-docker","inLanguage":"zh","author":"kentxxq","creator":"kentxxq","publisher":{"@type":"Organization","name":"kentxxq","logo":{"@type":"ImageObject","url":"https:\/\/kentxxq.com\/images/me/avatar.jpg"}},"accountablePerson":"kentxxq","copyrightHolder":"kentxxq","copyrightYear":"2019","datePublished":"2019-01-03 00:00:00","dateModified":"2021-02-26 00:06:04","url":"https:\/\/kentxxq.com\/contents\/%E5%BC%80%E5%8F%91%E4%BB%A5%E5%8F%8A%E8%BF%90%E7%BB%B4%E7%9A%84%E6%B5%81%E7%A8%8B-docker\/","keywords":["server","流程","docker","python","pipenv","wget","centos","nginx","redis","yum"]}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://kentxxq.com/>kentxxq Blog</a></div><div class="menu navbar-right"><a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/about/ title>About</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://kentxxq.com/>kentxxq Blog</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/about/ title>About</a></div></div></nav><main class=main><div class=container><article class=post-warp><header class=post-header><h1 class=post-title>开发以及运维的流程-docker</h1><div class=post-meta>Written by <a href=https://kentxxq.com/ rel=author>kentxxq</a>
with ♥
<span class=post-time>on <time datetime=2019-01-03>January 3, 2019</time></span>
in
<i class="iconfont icon-folder"></i>
<span class=post-category><a href=https://kentxxq.com/categories/%E7%AC%94%E8%AE%B0/>笔记</a></span>
|
<a href=#gitalk-container><span class=gitalk-comment-count itemprop=commentCount></span></a></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title></h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#个人开发以及部署>个人开发以及部署</a></li><li><a href=#从拿到centos服务器开始>从拿到centos服务器开始</a><ul><li><a href=#安装系统所需的repo>安装系统所需的repo</a></li><li><a href=#配置我所需要用到的服务>配置我所需要用到的服务</a></li><li><a href=#安装我所需要的工具>安装我所需要的工具</a></li><li><a href=#可选操作>可选操作</a></li></ul></li><li><a href=#开始部署自己的东西>开始部署自己的东西</a><ul><li><a href=#docker>docker</a></li><li><a href=#mongodb>mongodb</a></li><li><a href=#mysql>mysql</a></li><li><a href=#nginx>nginx</a></li><li><a href=#redis>redis</a></li><li><a href=#个人部署脚本>个人部署脚本</a></li></ul></li><li><a href=#webhook服务>webhook服务</a></li><li><a href=#团队以及企业开发上云k8s>团队以及企业开发(上云k8s)</a><ul><li><a href=#理清楚几个概念>理清楚几个概念</a></li></ul></li></ul></nav></div></div><script type=text/javascript>window.onload=function(){var a=$('.post-toc'),b=$('.post-comment'),f=a.offset().top,d=a.height(),g=a[0].offsetTop,e,c;$(window).scroll(function(){var h=Math.max(document.body.scrollTop,document.documentElement.scrollTop);b.length>0&&(c=b.offset().top,e=c-h-d),f<h?(a.css({position:'fixed'}),b.length>0&&c<h+d?a.css({top:e}):a.css({top:0})):(a.css({position:'absolute'}),a.css({top:g}))})}</script><div class=post-content><blockquote><p>开发以及运维的流程-docker</p></blockquote><h2 id=个人开发以及部署>个人开发以及部署</h2><ol><li>github提交代码</li><li>触发webhook，通过脚本让服务器上的容器停止，清除，重新打包，部署</li></ol><h2 id=从拿到centos服务器开始>从拿到centos服务器开始</h2><h3 id=安装系统所需的repo>安装系统所需的repo</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#官方的拓展库</span>
sudo yum install epel-release -y
<span style=color:#75715e>#Rpmfution只会分发red hat的规范不允许使用的库，它依赖于epel</span>
sudo yum install https://download1.rpmfusion.org/free/el/rpmfusion-free-release-7.noarch.rpm
sudo yum install https://download1.rpmfusion.org/nonfree/el/rpmfusion-nonfree-release-7.noarch.rpm
<span style=color:#75715e>#Elrepo    专注于硬件的驱动程序，比rpmfusion要多一些些，例如kmod同时还有内核，非常有用</span>
rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
rpm -Uvh https://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm
<span style=color:#75715e># 如果你需要超级高版本的git或者php之类的，可以看看这个库</span>
<span style=color:#75715e># 先默认用base里的，如果版本不能满足，那么就search一下，指不定能用上里面测试过的，兼容性好的包</span>
sudo yum install centos-release-scl unzip -y
<span style=color:#75715e># 更新到最新的版本</span>
sudo yum update -y
</code></pre></div><h3 id=配置我所需要用到的服务>配置我所需要用到的服务</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#Nginx 我的http代理</span>
sudo vi /etc/yum.repos.d/nginx.repo

<span style=color:#f92672>[</span>nginx<span style=color:#f92672>]</span>
name<span style=color:#f92672>=</span>nginx repo
baseurl<span style=color:#f92672>=</span>http://nginx.org/packages/centos/7/$basearch/
gpgcheck<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
enabled<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>

<span style=color:#75715e>#shadowsocks 翻墙工具c版本</span>
sudo vi /etc/yum.repos.d/shadowsocks.repo

<span style=color:#f92672>[</span>librehat-shadowsocks<span style=color:#f92672>]</span>
name<span style=color:#f92672>=</span>Copr repo <span style=color:#66d9ef>for</span> shadowsocks owned by librehat
baseurl<span style=color:#f92672>=</span>https://copr-be.cloud.fedoraproject.org/results/librehat/shadowsocks/epel-7-$basearch/
type<span style=color:#f92672>=</span>rpm-md
skip_if_unavailable<span style=color:#f92672>=</span>True
gpgcheck<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
gpgkey<span style=color:#f92672>=</span>https://copr-be.cloud.fedoraproject.org/results/librehat/shadowsocks/pubkey.gpg
repo_gpgcheck<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
enabled<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
enabled_metadata<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>

<span style=color:#75715e>#sudo 让kentxxq可以免密码sudo</span>
vi /etc/sudoers
kentxxq ALL<span style=color:#f92672>=(</span>ALL<span style=color:#f92672>)</span> NOPASSWD: ALL
useradd kentxxq
yourpassword
</code></pre></div><h3 id=安装我所需要的工具>安装我所需要的工具</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#Ohmyzsh 好用的shell</span>
sudo yum install -y git zsh
sh -c <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>wget https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
<span style=color:#75715e>#修改.zshrc文件。在linux中，先使用bashrc来初始化bash参数，然后用profile来修改个人参数。而zsh只需要修改zshrc即可）</span>

<span style=color:#75715e>#pyenv python的版本管理工具</span>
<span style=color:#75715e>#依赖</span>
sudo yum install -y gcc zlib-devel bzip2 bzip2-devel readline-devel sqlite sqlite-devel  openssl-devel xz xz-devel libffi-devel
<span style=color:#75715e>#开始安装</span>
curl -L https://github.com/pyenv/pyenv-installer/raw/master/bin/pyenv-installer | bash
<span style=color:#75715e>#global 是改变用户目录下的配置，</span>
<span style=color:#75715e>#local 是在当前文件夹内添加.python_version文件虚拟目录改成项目目录</span>
pyenv install 3.7.1
pyenv global 3.7.1

<span style=color:#75715e>#pipenv python的包管理工具</span>
pip install pipenv
<span style=color:#75715e>#把项目环境放入到项目目录。最好加入到.zshrc中</span>
export PIPENV_VENV_IN_PROJECT<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>

<span style=color:#75715e>#direnv 进入目录以后自动切换到对应的python环境</span>
sudo yum install golang
cd direnv
make
make install
<span style=color:#75715e>#修改.zshrc </span>
eval <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>direnv hook zsh<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>

<span style=color:#75715e>#安装ss</span>
sudo yum install shadowsocks-libev -y
<span style=color:#75715e>#修改它的systemd文件，方便配置</span>
<span style=color:#f92672>[</span>Unit<span style=color:#f92672>]</span>
Description<span style=color:#f92672>=</span>Shadowsocks-libev Default Server Service
Documentation<span style=color:#f92672>=</span>man:shadowsocks-libev<span style=color:#f92672>(</span>8<span style=color:#f92672>)</span>
After<span style=color:#f92672>=</span>network.target network-online.target
<span style=color:#f92672>[</span>Service<span style=color:#f92672>]</span>
Type<span style=color:#f92672>=</span>simple
ExecStart<span style=color:#f92672>=</span>/usr/bin/ss-server -c /etc/shadowsocks-libev/config.json -u
<span style=color:#f92672>[</span>Install<span style=color:#f92672>]</span>
WantedBy<span style=color:#f92672>=</span>multi-user.target
</code></pre></div><h3 id=可选操作>可选操作</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#安装dnf包管理器</span>
wget http://springdale.math.ias.edu/data/puias/unsupported/7/x86_64/dnf-conf-0.6.4-2.sdl7.noarch.rpm
wget http://springdale.math.ias.edu/data/puias/unsupported/7/x86_64//dnf-0.6.4-2.sdl7.noarch.rpm
wget http://springdale.math.ias.edu/data/puias/unsupported/7/x86_64/python-dnf-0.6.4-2.sdl7.noarch.rpm
yum install python-dnf-0.6.4-2.sdl7.noarch.rpm  dnf-0.6.4-2.sdl7.noarch.rpm dnf-conf-0.6.4-2.sdl7.noarch.rpm
</code></pre></div><h2 id=开始部署自己的东西>开始部署自己的东西</h2><h3 id=docker>docker</h3><p>参考<a href=https://www.docker.com/>官方手册</a>比较好</p><h3 id=mongodb>mongodb</h3><p>参考<a href=https://www.mongodb.com/>官方手册</a>比较好</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#初始化操作</span>
mongo 127.0.0.1
use admin
db.createUser<span style=color:#f92672>({</span>user: <span style=color:#e6db74>&#34;dba&#34;</span>,pwd: <span style=color:#e6db74>&#34;dba&#34;</span>,roles: <span style=color:#f92672>[</span> <span style=color:#f92672>{</span> role:”root”, db: <span style=color:#e6db74>&#34;admin&#34;</span> <span style=color:#f92672>}</span> <span style=color:#f92672>]}</span> <span style=color:#f92672>)</span>
</code></pre></div><h3 id=mysql>mysql</h3><p>参考<a href=https://www.mysql.com/>官方手册</a>比较好</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>yum install mysql
</code></pre></div><h3 id=nginx>nginx</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>server <span style=color:#f92672>{</span>
    listen       80;
    server_name  _; 
    rewrite ^<span style=color:#f92672>(</span>.*<span style=color:#f92672>)</span> https://$host$1 permanent; 
<span style=color:#f92672>}</span>

server <span style=color:#f92672>{</span>
    listen 443;
    server_name kentxxq.com;

    ssl on;
    ssl_certificate ssl/cert-1535694093490_kentxxq.com.crt;
    ssl_certificate_key ssl/cert-1535694093490_kentxxq.com.key;

    location /wechat/ <span style=color:#f92672>{</span>
        proxy_pass http://127.0.0.1:8080;
    <span style=color:#f92672>}</span>

    location / <span style=color:#f92672>{</span>
        proxy_pass http://127.0.0.1:1313;
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=redis>redis</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo docker run -d --name redis --rm -p 6379:6379 redis:alpine
<span style=color:#75715e>#使用redis-cli登陆来查看数据</span>
</code></pre></div><h3 id=个人部署脚本>个人部署脚本</h3><p>进行容器关闭，镜像拉取，镜像清理，启动新容器</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#! /bin/bash
</span><span style=color:#75715e></span>

IMAGE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;image-url&#34;</span>
echo <span style=color:#e6db74>&#39;关闭容器&#39;</span>
sudo docker ps | grep wechat_test | awk <span style=color:#e6db74>&#39;{print $1}&#39;</span> | xargs sudo docker stop
echo <span style=color:#e6db74>&#39;拉取镜像&#39;</span>
sudo docker pull $IMAGE
echo <span style=color:#e6db74>&#39;清理镜像&#39;</span>
sudo docker images prune
sudo docker images | grep <span style=color:#e6db74>&#39;none&#39;</span> |awk <span style=color:#e6db74>&#39;{print $3}&#39;</span>|xargs sudo docker image rm -f
echo <span style=color:#e6db74>&#39;启动wechat_test镜像&#39;</span>
sudo docker run -p 8080:8080 --rm --name wechat_test  -d $IMAGE
</code></pre></div><h2 id=webhook服务>webhook服务</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#! /usr/bin/python3</span>
<span style=color:#75715e># coding:utf-8</span>
<span style=color:#f92672>from</span> http.server <span style=color:#f92672>import</span> SimpleHTTPRequestHandler, HTTPServer
<span style=color:#f92672>import</span> logging
<span style=color:#f92672>import</span> os
<span style=color:#f92672>import</span> delegator
<span style=color:#f92672>import</span> json
<span style=color:#f92672>import</span> hmac
<span style=color:#f92672>import</span> hashlib
<span style=color:#f92672>from</span> threading <span style=color:#f92672>import</span> Thread


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>deployThread</span>(Thread):
    <span style=color:#66d9ef>def</span> __init__(self, signature: str, data: bytes):
        super()<span style=color:#f92672>.</span>__init__()
        self<span style=color:#f92672>.</span>signature <span style=color:#f92672>=</span> signature
        self<span style=color:#f92672>.</span>data <span style=color:#f92672>=</span> data

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>run</span>(self):
        <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;deploy&#39;</span>)
        blog_v <span style=color:#f92672>=</span> hmac<span style=color:#f92672>.</span>new(blog_token, self<span style=color:#f92672>.</span>data, hashlib<span style=color:#f92672>.</span>sha1)<span style=color:#f92672>.</span>hexdigest()
        wechat_v <span style=color:#f92672>=</span> hmac<span style=color:#f92672>.</span>new(wechat_token, self<span style=color:#f92672>.</span>data, hashlib<span style=color:#f92672>.</span>sha1)<span style=color:#f92672>.</span>hexdigest()
        <span style=color:#66d9ef>try</span>:
            <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>signature <span style=color:#f92672>==</span> wechat_v:
                logging<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#39;begin wechat&#39;</span>)
                result <span style=color:#f92672>=</span> delegator<span style=color:#f92672>.</span>run(
                    <span style=color:#e6db74>&#39;sh /home/kentxxq/wechat/deploy.sh&#39;</span>)
            <span style=color:#66d9ef>elif</span> self<span style=color:#f92672>.</span>signature <span style=color:#f92672>==</span> blog_v:
                <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#34;begin blog&#34;</span>)
                result <span style=color:#f92672>=</span> delegator<span style=color:#f92672>.</span>run(
                    <span style=color:#e6db74>&#39;sh /home/kentxxq/blog/deploy.sh&#39;</span>)
            <span style=color:#66d9ef>print</span>(result<span style=color:#f92672>.</span>out)
        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span>:
            logging<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#39;request error&#39;</span>)


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Handler</span>(SimpleHTTPRequestHandler):
    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>do_POST</span>(self):
        <span style=color:#e6db74>&#39;&#39;&#39;disable post request&#39;&#39;&#39;</span>
        <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;got post request&#39;</span>, self<span style=color:#f92672>.</span>path, self<span style=color:#f92672>.</span>headers)

        <span style=color:#66d9ef>try</span>:
            sha1_flag, signature <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;X-Hub-Signature&#39;</span>]<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;=&#39;</span>)
            <span style=color:#75715e># add length for speed faster</span>
            data <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>rfile<span style=color:#f92672>.</span>read(int(self<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;Content-Length&#39;</span>]))
            xx <span style=color:#f92672>=</span> deployThread(signature, data)
            xx<span style=color:#f92672>.</span>start()
            self<span style=color:#f92672>.</span>send_response(<span style=color:#ae81ff>200</span>)
            self<span style=color:#f92672>.</span>send_header(<span style=color:#e6db74>&#39;Content-type&#39;</span>, <span style=color:#e6db74>&#39;text/html&#39;</span>)
            self<span style=color:#f92672>.</span>end_headers()
            <span style=color:#75715e># Send the html message</span>
            self<span style=color:#f92672>.</span>wfile<span style=color:#f92672>.</span>write(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;ok&#34;</span>)
            <span style=color:#66d9ef>return</span>
        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span>:
            <span style=color:#66d9ef>pass</span>

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>do_GET</span>(self):
        <span style=color:#e6db74>&#39;&#39;&#39;disable get request&#39;&#39;&#39;</span>
        self<span style=color:#f92672>.</span>send_response(<span style=color:#ae81ff>200</span>)
        self<span style=color:#f92672>.</span>send_header(<span style=color:#e6db74>&#39;Content-type&#39;</span>, <span style=color:#e6db74>&#39;text/html&#39;</span>)
        self<span style=color:#f92672>.</span>end_headers()
        <span style=color:#75715e># Send the html message</span>
        self<span style=color:#f92672>.</span>wfile<span style=color:#f92672>.</span>write(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;hello&#34;</span>)
        <span style=color:#66d9ef>return</span>


<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
    addr <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;127.0.0.1&#39;</span>
    port <span style=color:#f92672>=</span> <span style=color:#ae81ff>8555</span>
    httpd <span style=color:#f92672>=</span> HTTPServer((addr, port), Handler)
    <span style=color:#75715e># get system var</span>
    wechat_token <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>environ[<span style=color:#e6db74>&#39;WECHAT_AUTH_TOKEN&#39;</span>]<span style=color:#f92672>.</span>encode(encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ascii&#39;</span>)
    blog_token <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>environ[<span style=color:#e6db74>&#39;BLOG_AUTH_TOKEN&#39;</span>]<span style=color:#f92672>.</span>encode(encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ascii&#39;</span>)
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;nohup python3 -u /usr/local/bin/docker-hook &amp;&#39;</span>)
    httpd<span style=color:#f92672>.</span>serve_forever()
</code></pre></div><p>使用<code>nohup python -u /usr/local/bin/docker-hook &</code>进行后台，可以把日志输出到nohup.out文件</p><h2 id=团队以及企业开发上云k8s>团队以及企业开发(上云k8s)</h2><ol><li>项目直接部署到云服务商的代码管理</li><li>开通k8s的产品服务，规划好要求</li><li>建立流水线，触发测试环境的自动部署</li><li>测试环境没有问题以后，人工触发生产环境的部署服务</li></ol><h3 id=理清楚几个概念>理清楚几个概念</h3><ol><li>设置集群的硬件需求</li><li>部署一个应用，就是一个负载。可以多个应用/负载</li><li>应用内的pod是k8s的最小控制单位。配置pod的replicas数量,来决定运行多少个容器提供服务。pod可以自动调节数量和故障节点切换</li><li>创建一个service，它控制负载均衡当前应用所有的pods，并且对外提供访问</li><li>对于集群外的云数据库，可以使用endpoints。使其变成一个内部可以访问的service</li></ol></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>kentxxq</span></p><p class=copyright-item><span>Link:</span>
<a href=https://kentxxq.com/contents/%E5%BC%80%E5%8F%91%E4%BB%A5%E5%8F%8A%E8%BF%90%E7%BB%B4%E7%9A%84%E6%B5%81%E7%A8%8B-docker/><script>document.write(decodeURI(location.origin+location.pathname))</script></a></p><p class="copyright-item lincese">本文采用<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p></div><div class=post-tags><section><i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://kentxxq.com/tags/server/>#server</a></span></section><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://kentxxq.com/>home</a></span></section></div><div class=post-nav><a href=https://kentxxq.com/contents/%E8%BD%AC%E5%88%B0hugo/ class=prev rel=prev title=转到hugo后的架构><i class="iconfont icon-left"></i>&nbsp;转到hugo后的架构</a>
<a href=https://kentxxq.com/contents/git%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ class=next rel=next title=git的常用命令>git的常用命令&nbsp;<i class="iconfont icon-right"></i></a></div></article></div></main><footer class=footer><a href=https://beian.miit.gov.cn/ target=_blank rel="external nofollow">湘ICP备2021002319号-1</a></footer><script src=/js/vendor_no_gallery.min.js async></script><script src=https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js></script></div></body></html>