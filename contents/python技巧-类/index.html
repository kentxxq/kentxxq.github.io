<!doctype html><html lang=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-131319987-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-131319987-1')</script><meta name=author content="kentxxq"><meta name=keywords content="python 元类 类方法 静态方法"><meta name=description content="最近把手上的事情都忙完了。准备来好好巩固自己的python知识。为什么标题是技巧呢，因为这部分是它和其他语言最大的不同，或者说特点。要玩得6，不熟这一些知识点，肯定是不行"><meta property="og:title" content="python技巧-类"><meta property="og:description" content="最近把手上的事情都忙完了。准备来好好巩固自己的python知识。为什么标题是技巧呢，因为这部分是它和其他语言最大的不同，或者说特点。要玩得6，不熟这一些知识点，肯定是不行"><meta property="og:type" content="article"><meta property="og:url" content="https://kentxxq.com/contents/python%E6%8A%80%E5%B7%A7-%E7%B1%BB/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-11-26T00:00:00+08:00"><meta property="article:modified_time" content="2021-02-26T00:06:04+08:00"><link rel=prev href=https://kentxxq.com/contents/%E5%B8%B8%E7%94%A8%E7%9A%84%E4%BF%A1%E6%81%AF%E6%89%8B%E5%86%8C/><link rel=next href=https://kentxxq.com/contents/%E6%88%91%E7%9A%84%E4%B8%AA%E4%BA%BA%E7%94%B5%E5%AD%90%E4%BA%A7%E5%93%81%E8%B7%AF%E7%BA%BF/><link rel=canonical href=https://kentxxq.com/contents/python%E6%8A%80%E5%B7%A7-%E7%B1%BB/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=icon type=image/png href=/favicon.png><title>python技巧-类 | kentxxq Blog</title><meta name=title content="python技巧-类 | kentxxq Blog"><link rel=stylesheet href=/font/iconfont.css><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","image":"https:\/\/kentxxq.com\/images/me/avatar.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kentxxq.com\/"},"articleSection":"posts","name":"python技巧-类","headline":"python技巧-类","description":"最近把手上的事情都忙完了。准备来好好巩固自己的python知识。为什么标题是技巧呢，因为这部分是它和其他语言最大的不同，或者说特点。要玩得6，不熟这一些知识点，肯定是不行","inLanguage":"zh","author":"kentxxq","creator":"kentxxq","publisher":{"@type":"Organization","name":"kentxxq","logo":{"@type":"ImageObject","url":"https:\/\/kentxxq.com\/images/me/avatar.jpg"}},"accountablePerson":"kentxxq","copyrightHolder":"kentxxq","copyrightYear":"2019","datePublished":"2019-11-26 00:00:00","dateModified":"2019-11-26 00:00:00","url":"https:\/\/kentxxq.com\/contents\/python%E6%8A%80%E5%B7%A7-%E7%B1%BB\/","keywords":["python","元类","类方法","静态方法"]}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://kentxxq.com/>kentxxq Blog</a></div><div class="menu navbar-right"><a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/about/ title>About</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://kentxxq.com/>kentxxq Blog</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/about/ title>About</a></div></div></nav><main class=main><div class=container><article class=post-warp><header class=post-header><h1 class=post-title>python技巧-类</h1><div class=post-meta>Written by <a href=https://kentxxq.com/ rel=author>kentxxq</a>
with ♥
<span class=post-time>on <time datetime=2019-11-26>November 26, 2019</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=https://kentxxq.com/categories/%E7%AC%94%E8%AE%B0/>笔记</a></span>
|
<a href=#gitalk-container><span class=gitalk-comment-count itemprop=commentCount></span></a></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title></h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#python的类>python的类</a><ul><li><a href=#先说type函数>先说type函数</a></li><li><a href=#type和元类>type和元类</a></li><li><a href=#特殊的内部函数>特殊的内部函数</a></li></ul></li><li><a href=#类方法和静态方法>类方法和静态方法</a></li><li><a href=#好的技巧资料>好的技巧资料</a><ul><li><a href=#python-cookbookhttpspython3-cookbookreadthedocsiozh_cnlatest><a href=https://python3-cookbook.readthedocs.io/zh_CN/latest/>Python Cookbook</a></a></li></ul></li></ul></nav></div></div><script type=text/javascript>window.onload=function(){var a=$('.post-toc'),b=$('.post-comment'),f=a.offset().top,d=a.height(),g=a[0].offsetTop,e,c;$(window).scroll(function(){var h=Math.max(document.body.scrollTop,document.documentElement.scrollTop);b.length>0&&(c=b.offset().top,e=c-h-d),f<h?(a.css({position:'fixed'}),b.length>0&&c<h+d?a.css({top:e}):a.css({top:0})):(a.css({position:'absolute'}),a.css({top:g}))})}</script><div class=post-content><blockquote><p>最近把手上的事情都忙完了。准备来好好巩固自己的python知识。为什么标题是技巧呢，因为这部分是它和其他语言最大的不同，或者说特点。要玩得6，不熟这一些知识点，肯定是不行。</p></blockquote><h2 id=python的类>python的类</h2><p>python可以用函数式编程。也支持面向对象编程。</p><p>在使用函数式编程的时候，多数都是用来写脚本。同时这也是python最开始发光发亮的点。但是在处理结构性数据以及架构项目的时候，面向对象的优势就会凸显出来。同时也有很多的黑魔法让你快速完成原型的构造。</p><h3 id=先说type函数>先说type函数</h3><p>我们经常用type函数来查看对象的类型信息。但还有一个用法，就是用type来生成对象。当你在写python class代码的时候，解析器遇到class代码块，就会解析class结构，然后用type来构造对象。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># name代表类名，base代表父类或者说基类，attrs为字典形式，代表属性值。</span>
type(name, base, attrs)
</code></pre></div><h3 id=type和元类>type和元类</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TMetaClass</span>(type):
    <span style=color:#66d9ef>def</span> __new__(cls, name, base, attrs):
        <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;in TMetaClass new&#39;</span>)
        <span style=color:#66d9ef>return</span> type<span style=color:#f92672>.</span>__new__(cls, name, base, attrs)

    <span style=color:#66d9ef>def</span> __init__(self, object_or_name, bases, dict):
        <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;in TMetaClass init&#39;</span>)
        super()<span style=color:#f92672>.</span>__init__(object_or_name, bases, dict)


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Person</span>(metaclass<span style=color:#f92672>=</span>TMetaClass):
    <span style=color:#66d9ef>def</span> __new__(cls):
        <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;in Person&#39;</span>)
        <span style=color:#66d9ef>return</span> object<span style=color:#f92672>.</span>__new__(cls)

    <span style=color:#66d9ef>def</span> __init__(self):
        <span style=color:#66d9ef>print</span>(self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__)
        super()<span style=color:#f92672>.</span>__init__()

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test</span>(self):
        <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;Person test..&#39;</span>)


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Man</span>(Person):
    <span style=color:#66d9ef>def</span> __new__(cls):
        <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;in Man&#39;</span>)
        <span style=color:#66d9ef>return</span> object<span style=color:#f92672>.</span>__new__(cls)

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test</span>(self):
        <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;Man test..&#39;</span>)


<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;-&#39;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>20</span>)
kentxxq1 <span style=color:#f92672>=</span> Person()
kentxxq1<span style=color:#f92672>.</span>test()

<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;-&#39;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>20</span>)
kentxxq2 <span style=color:#f92672>=</span> Man()
kentxxq2<span style=color:#f92672>.</span>test()
<span style=color:#75715e># 结果</span>
<span style=color:#75715e># in TMetaClass new</span>
<span style=color:#75715e># in TMetaClass init</span>
<span style=color:#75715e># in TMetaClass new</span>
<span style=color:#75715e># in TMetaClass init</span>
<span style=color:#75715e># --------------------</span>
<span style=color:#75715e># in Person</span>
<span style=color:#75715e># Person</span>
<span style=color:#75715e># Person test..</span>
<span style=color:#75715e># --------------------</span>
<span style=color:#75715e># in Man</span>
<span style=color:#75715e># Man</span>
<span style=color:#75715e># Man test..</span>
</code></pre></div><p>总结几个要点:</p><ol><li>type可以通常被继承来使用。用法是<code>type.__new__</code>，如果<code>__new__</code>方法返回的不是实例化时的类型，不会进入到<code>__init__</code>方法。</li><li>Person指定元类以后，在定义过程中会进入元类<code>__new__</code>和<code>__init__</code>方法。而Man继承Person以后，定义过程也是进入元类的方法。在python中类也是对象，这里说的定义过程，也就是构建一个类对象。</li><li>而在实例化的过程中。使用的都是各自的<code>__new__</code>方法。这里的实例化是将类对象进行实例化。</li></ol><p>你在正常的代码编写过程中，很容易想到剥离相同的代码。放到一个基类中。那你什么时候应该要想到用基类呢？当你想要控制子类的行为时。</p><p>可以参考orm的做法，那么是实际代码中的使用方法应该如下:</p><ol><li>在元类中编写构建类时需要做的事情。例如把子类所有的数据存放到一个__mapping__字典中。</li><li>编写一个基类，把所有继承者通用特性综合到一起。</li><li>在继承者内部编写不同之处(调用者)。调用者可以非常方便的去使用基类，编写简单明了的代码。</li></ol><p>上面的例子，是判断字段是否为Field类型。如果是的，那么这个变量代表的就是数据库内的字段名。</p><p>再举个例子，别人在继承你的基类时，加上了一个名字为kentxxq的变量，但是你对这个名字深恶痛绝！你就可以在基类指定metaclass，而metaclass里对attrs进行判断，然后去掉它。这样别人要是不理解元类，就只能改变量名了！同样的方法，你也可以修改name和base。也就是说，你可以通过条件操作这个子类会变成什么样子。</p><p>还来一个例子，哈哈。你写了一个很牛逼很牛逼的通用工具模块。别人只需要继承你，就可以让代码性能提高10000%！你想看看到底有多少人再用！那么你就可以在这里做个统计，不就明白啦！</p><p>当然还有很多的地方可以用上，关键在于你的需求。</p><h3 id=特殊的内部函数>特殊的内部函数</h3><table><thead><tr><th>方法</th><th>调用方式</th><th>解释</th></tr></thead><tbody><tr><td>__new__(cls [,&mldr;])</td><td>instance = MyClass(arg1, arg2)</td><td>__new__ 在创建实例的时候被调用</td></tr><tr><td>__init__(self [,&mldr;])</td><td>instance = MyClass(arg1, arg2)</td><td>__init__ 在创建实例的时候被调用</td></tr><tr><td>__cmp__(self, other)</td><td>self == other, self > other, 等。</td><td>在比较的时候调用</td></tr><tr><td>__pos__(self)</td><td>+self</td><td>一元加运算符</td></tr><tr><td>__neg__(self)</td><td>-self</td><td>一元减运算符</td></tr><tr><td>__invert__(self)</td><td>~self</td><td>取反运算符</td></tr><tr><td>__index__(self)</td><td>x[self]</td><td>对象被作为索引使用的时候</td></tr><tr><td>__nonzero__(self)</td><td>bool(self)</td><td>对象的布尔值</td></tr><tr><td>__getattr__(self, name)</td><td>self.name # name 不存在</td><td>访问一个不存在的属性时</td></tr><tr><td>__setattr__(self, name, val)</td><td>self.name = val</td><td>对一个属性赋值时</td></tr><tr><td>__delattr__(self, name)</td><td>del self.name</td><td>删除一个属性时</td></tr><tr><td>__getattribute__(self, name)</td><td>self.name</td><td>访问任何属性时</td></tr><tr><td>__getitem__(self, key)</td><td>self[key]</td><td>使用索引访问元素时</td></tr><tr><td>__setitem__(self, key, val)</td><td>self[key] = val</td><td>对某个索引值赋值时</td></tr><tr><td>__delitem__(self, key)</td><td>del self[key]</td><td>删除某个索引值时</td></tr><tr><td>__iter__(self)</td><td>for x in self</td><td>迭代时</td></tr><tr><td>__contains__(self, value)</td><td>value in self, value not in self</td><td>使用 in 操作测试关系时</td></tr><tr><td>__concat__(self, value)</td><td>self + other</td><td>连接两个对象时</td></tr><tr><td>__call__(self [,&mldr;])</td><td>self(args)</td><td>“调用”对象时</td></tr><tr><td>__enter__(self)</td><td>with self as x:</td><td>with 语句环境管理</td></tr><tr><td>__exit__(self, exc, val, trace)</td><td>with self as x:</td><td>with 语句环境管理</td></tr><tr><td>__getstate__(self)</td><td>pickle.dump(pkl_file, self)</td><td>序列化</td></tr><tr><td>__setstate__(self)</td><td>data = pickle.load(pkl_file)</td><td>序列化</td></tr></tbody></table><p>内部完整文档可以参考<a href=https://docs.python.org/zh-cn/3/reference/datamodel.html>官方</a></p><h2 id=类方法和静态方法>类方法和静态方法</h2><p><code>classmethod</code>通常用来创造此类的实例。例如你需要通过别人的参数，来创造一个实例。但是参数可以包括对象、json等。</p><p>好处:</p><ol><li>简单且逻辑直观。</li><li>不需要实例化就可以使用。</li><li>还可以在内部调用静态方法。完整复杂的操作。</li></ol><p><code>staticmethod</code>是为了解决各种尴尬的问题。当你需要一个通用的Tools类时，内部都写成静态方法是不错的选择。</p><p>可能遇到的尴尬之处:</p><ol><li>写做外部方法，但不够通用。</li><li>作为内部普通方法，却想不需要实例化就使用。</li><li>和类方法对比起来。却又不需要和类对象有任何关系。</li></ol><h2 id=好的技巧资料>好的技巧资料</h2><h3 id=python-cookbookhttpspython3-cookbookreadthedocsiozh_cnlatest><a href=https://python3-cookbook.readthedocs.io/zh_CN/latest/>Python Cookbook</a></h3></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>kentxxq</span></p><p class=copyright-item><span>Link:</span>
<a href=https://kentxxq.com/contents/python%E6%8A%80%E5%B7%A7-%E7%B1%BB/><script>document.write(decodeURI(location.origin+location.pathname))</script></a></p><p class="copyright-item lincese">本文采用<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p></div><div class=post-tags><section><i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://kentxxq.com/tags/python/>#python</a></span></section><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://kentxxq.com/>home</a></span></section></div><div class=post-nav><a href=https://kentxxq.com/contents/%E5%B8%B8%E7%94%A8%E7%9A%84%E4%BF%A1%E6%81%AF%E6%89%8B%E5%86%8C/ class=prev rel=prev title=常用的信息手册><i class="iconfont icon-left"></i>&nbsp;常用的信息手册</a>
<a href=https://kentxxq.com/contents/%E6%88%91%E7%9A%84%E4%B8%AA%E4%BA%BA%E7%94%B5%E5%AD%90%E4%BA%A7%E5%93%81%E8%B7%AF%E7%BA%BF/ class=next rel=next title=我的个人电子产品路线>我的个人电子产品路线&nbsp;<i class="iconfont icon-right"></i></a></div></article><div class=post-comment><div id=disqus_thread></div><script>var disqus_config=function(){this.page.title="python技巧-类",this.page.url="https://kentxxq.com/contents/python%E6%8A%80%E5%B7%A7-%E7%B1%BB/"};(function(){var a=document,b=a.createElement('script');b.src='https://kentxxq.disqus.com/embed.js',b.setAttribute('data-timestamp',+new Date),(a.head||a.body).appendChild(b)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by
Disqus.</a></noscript></div></div></main><footer class=footer><a href=https://beian.miit.gov.cn/ target=_blank rel="external nofollow">湘ICP备2021002319号-1</a></footer><script src=/js/vendor_no_gallery.min.js async></script><script src=https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js></script></div></body></html>