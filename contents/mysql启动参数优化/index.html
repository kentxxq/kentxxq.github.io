<!doctype html><html lang=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-131319987-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-131319987-1')</script><meta name=author content="kentxxq"><meta name=keywords content="mysql 启动参数 优化"><meta name=description content="mysql启动参数优化"><link rel=prev href=https://kentxxq.com/contents/mysql%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/><link rel=next href=https://kentxxq.com/contents/mysqladmin/><link rel=canonical href=https://kentxxq.com/contents/mysql%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=icon type=image/png href=/favicon.png><title>mysql启动参数优化 | kentxxq Blog</title><meta name=title content="mysql启动参数优化 | kentxxq Blog"><link rel=stylesheet href=/font/iconfont.css><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","image":"https:\/\/kentxxq.com\/images/me/avatar.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kentxxq.com\/"},"articleSection":"posts","name":"mysql启动参数优化","headline":"mysql启动参数优化","description":"mysql启动参数优化","inLanguage":"zh","author":"kentxxq","creator":"kentxxq","publisher":{"@type":"Organization","name":"kentxxq","logo":{"@type":"ImageObject","url":"https:\/\/kentxxq.com\/images/me/avatar.jpg"}},"accountablePerson":"kentxxq","copyrightHolder":"kentxxq","copyrightYear":"1993","datePublished":"1993-07-06 00:00:00","dateModified":"1993-07-06 00:00:00","url":"https:\/\/kentxxq.com\/contents\/mysql%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96\/","keywords":["mysql","启动参数","优化"]}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://kentxxq.com/>kentxxq Blog</a></div><div class="menu navbar-right"><a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/about/ title>About</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://kentxxq.com/>kentxxq Blog</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/about/ title>About</a></div></div></nav><main class=main><div class=container><article class=post-warp><header class=post-header><h1 class=post-title>mysql启动参数优化</h1><div class=post-meta>Written by <a href=https://kentxxq.com/ rel=author>kentxxq</a>
with ♥
<span class=post-time>on <time datetime=1993-07-06>July 6, 1993</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=https://kentxxq.com/categories/%E7%AC%94%E8%AE%B0/>笔记</a></span>
|
<a href=#gitalk-container><span class=gitalk-comment-count itemprop=commentCount></span></a></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title></h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#参数文件>参数文件</a></li><li><a href=#随记>随记</a></li></ul></nav></div></div><script type=text/javascript>window.onload=function(){var a=$('.post-toc'),b=$('.post-comment'),f=a.offset().top,d=a.height(),g=a[0].offsetTop,e,c;$(window).scroll(function(){var h=Math.max(document.body.scrollTop,document.documentElement.scrollTop);b.length>0&&(c=b.offset().top,e=c-h-d),f<h?(a.css({position:'fixed'}),b.length>0&&c<h+d?a.css({top:e}):a.css({top:0})):(a.css({position:'absolute'}),a.css({top:g}))})}</script><div class=post-content><h2 id=参数文件>参数文件</h2><pre><code class=language-bash data-lang=bash>[mysqld]

### 
#  基本相关配置
###
server-id=1
pid-file=/var/run/mysqld/mysqld.pid
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock
# 在linux中，文件可以进行ln，类似快捷方式。如果设置为1，则有可能会出现安全问题，默认配置中设置为0，进行关闭
symbolic-links=0
# 设置数据库字符集
character_set_server=utf8mb4
# 禁止MySQL对外部连接进行DNS解析，使用这一选项可以消除MySQL进行DNS解析的时间。但需要注意，如果开启该选项，则所有远程主机连接授权都要使用IP地址方式，否则MySQL将无法正常处理连接请求
skip-name-resolve
character_set_filesystem=utf8mb4
# 统一使用小写的表名
lower_case_table_names = 1




### 
#  日志配置
###
log-error=/var/log/mysqld.log
# 二进制日志路径
log-bin=/tmp/logbin
# 超过30天的binlog删除
expire_logs_days = 30
# 慢查询时间 超过1秒则为慢查询
long_query_time = 1
slow_query_log_file = /tmp/mysql-slow.log




### 
#  性能提升参数
###
# mysql最大连接数 查看max_used_connections，在最大值的70%左右最好
max_connections = 1000
# 官方：8 + (max_connections / 100)，上限100. 缓存的线程池不应该过多。
# 暂时我的业务高峰期，估计是200+的并发一直保持。50个应该足够
# 一般来说，大于4G的内存，预先缓存50个线程没有问题
thread_cache_size=10
# 表缓存分为多个区。5.7开始16为默认值，非常好！
# table_open_cache_instances=16
# 查询缓存关闭
# 听起来很美好的参数而已：如果表有insert、update等操作，表的相关所有cache失效
# 保存的是一个sql的查询结果集，而不是执行计划之类的
query_cache_size=0

# INNODB
# innodb非常好！所以默认使用它做存储引擎。 设置为总内存的80%
innodb_buffer_pool_size=800m
# 为提高性能，MySQL可以以循环方式将日志文件写到多个文件。推荐设置为3
innodb_log_files_in_group = 3
# SHOW GLOBAL STATUS like '%innodb_os_log_written%' 单位：字节
# 官方推荐innodb_log_files_in_group*innodb_log_file_size * 0.75 &gt; 209MB，可以设置更大一些，但1小时内最好内进行一次刷入磁盘
innodb_log_file_size=140m
## 这里我启用的搭配模式，满足性能要求，系统一般情况下不会断电就不会崩溃。
# 控制数据库的事务日志刷到磁盘上
# 0:最快，但是进程崩溃就会丢失数据
# 1:最慢，数据会回滚没有提交的操作，数据保证一致
# 2:性能不错，除非操作系统不可用，才会丢失数据
innodb_flush_log_at_trx_commit=2
# 控制数据库的binlog刷到磁盘上
# 0:最快 系统决定
# n:10000&gt;n&gt;1 多少条日志记录后开刷
# 1:每次提交就开刷
sync_binlog=0
# O_DIRECT直接跨过os缓存，直接写入到文件。  直接在raid上操作数据会更快
# 默认为空：fsync                        直接连接到san存储，会更快
# O_DSYNC很少使用，没有上两个设置的优点
innodb_flush_method=O_DIRECT
# 不限制线程并发的数量，在大型系统中会进行集群，同时会分配好任务，所以不需要调整
# 如果是单个的数据库，最高并发数量达到了100，那么设置为80，将会很好的满足需求
innodb_thread_concurrency=0
# mysql5.7的默认值，会提高速度
innodb_checksum_algorithm=crc32
# 不会有很大的提升，但是如果你的磁盘非常快，可以提高到16-32之间
innodb_read_io_threads=8
innodb_write_io_threads=8
# 刷新脏数据时每秒写 IO请求数 默认200即可，除非用sysbench压力测试，tps一段时间内为0，是因为它的问题。而且磁盘速度非常快
# 数值过大，mysql认为磁盘能力很强，不会着急得把redo log刷到磁盘。而不大或者100这样比较小的值，则会认为磁盘能力一般，提早刷入磁盘
innodb_io_capacity=200
# 关闭的时候把缓冲了的数据记录id记录到文件，启动的时候加载进来，这样尽可能的让它在重启的时候，缓冲数据完全一致
innodb_buffer_pool_load_at_startup=on
innodb_buffer_pool_dump_at_shutdown=on




### 
#  连接相关参数
###
# 设置同一主机，最大可连接报错数。设置成100万没有特别大的影响，但是极大减少了flush hosts的次数
max_connect_errors=1000000
# 连接到达数量之后，排队的请求格式。超过600就会拒绝
back_log = 600
# 会话超过多久自动断开，默认秒，8小时
wait_timeout = 28800


# mysql可以打开的文件数       
open_files_limit = 65535


### 
# 备份工具innobackupex的备份路径
###
[xtrabackup]
target_dir = /tmp/backups

</code></pre><h2 id=随记>随记</h2><p>为了搞定这一系列的参数，真是花了好大力气，也加深了对<code>mysql</code>的了解</p><pre><code>2015-06-17 17:28:53 26720 [Warning] Buffered warning: Changed limits: max_connections: 5000 (requested 65535)
2015-06-17 17:28:53 26720 [Warning] Buffered warning: Changed limits: table_open_cache: 1995 (requested 2000)
</code></pre><p>这个问题的<a href=https://dev.mysql.com/doc/refman/5.7/en/using-systemd.html>解决办法</a></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 修改系统的参数</span>
vi /etc/security/limits.conf
<span style=color:#75715e># 加入这两行，或者把*指定为mysql用户</span>
*                soft    nofile          <span style=color:#ae81ff>65535</span>
*                hard    nofile          <span style=color:#ae81ff>65535</span>

<span style=color:#75715e># 这个是mysql服务的参数，也要加上</span>
mkdir /etc/systemd/system/mysqld.service.d  //if not exists
vi limits.conf

<span style=color:#f92672>[</span>root@centos1 system<span style=color:#f92672>]</span><span style=color:#75715e># cat /etc/systemd/system/mysql.service.d/override.conf</span>
<span style=color:#f92672>[</span>Service<span style=color:#f92672>]</span>
LimitNOFILE<span style=color:#f92672>=</span><span style=color:#ae81ff>65535</span>
</code></pre></div></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>kentxxq</span></p><p class=copyright-item><span>Link:</span>
<a href=https://kentxxq.com/contents/mysql%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96/><script>document.write(decodeURI(location.origin+location.pathname))</script></a></p><p class="copyright-item lincese">本文采用<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p></div><div class=post-tags><section><i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://kentxxq.com/tags/mysql/>#mysql</a></span></section><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://kentxxq.com/>home</a></span></section></div><div class=post-nav><a href=https://kentxxq.com/contents/mysql%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/ class=prev rel=prev title=mysql备份恢复><i class="iconfont icon-left"></i>&nbsp;mysql备份恢复</a>
<a href=https://kentxxq.com/contents/mysqladmin/ class=next rel=next title=mysqladmin>mysqladmin&nbsp;<i class="iconfont icon-right"></i></a></div></article><div class=post-comment><div id=disqus_thread></div><script>var disqus_config=function(){this.page.title="mysql启动参数优化",this.page.url="https://kentxxq.com/contents/mysql%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96/"};(function(){var a=document,b=a.createElement('script');b.src='https://kentxxq.disqus.com/embed.js',b.setAttribute('data-timestamp',+new Date),(a.head||a.body).appendChild(b)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by
Disqus.</a></noscript></div></div></main><footer class=footer><a href=https://beian.miit.gov.cn/ target=_blank rel="external nofollow">湘ICP备2021002319号-1</a></footer><script src=/js/vendor_no_gallery.min.js async></script><script src=https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js></script></div></body></html>