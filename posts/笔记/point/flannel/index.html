<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Flannel - 运维个人技术栈</title><meta name=Description content="kentxxq个人站点"><meta property="og:title" content="Flannel"><meta property="og:description" content="5.3 Flannel 5.3.1 overlay network 介绍Overlay 网络是指在不改变现有网络基础设施的前提下，通过某种约定通信协议，把二层报文封装在 IP 报文之上的新的数据格式。这样不"><meta property="og:type" content="article"><meta property="og:url" content="https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/point/flannel/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-24T00:00:00+00:00"><meta property="article:modified_time" content="2023-11-24T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Flannel"><meta name=twitter:description content="5.3 Flannel 5.3.1 overlay network 介绍Overlay 网络是指在不改变现有网络基础设施的前提下，通过某种约定通信协议，把二层报文封装在 IP 报文之上的新的数据格式。这样不"><meta name=application-name content="kentxxq"><meta name=apple-mobile-web-app-title content="kentxxq"><meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/point/flannel/><link rel=prev href=https://kentxxq.com/posts/%E6%97%A5%E8%AE%B0/2023-11-19/><link rel=next href=https://kentxxq.com/posts/%E6%97%A5%E8%AE%B0/2023-11-25/><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Flannel","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kentxxq.com\/posts\/%E7%AC%94%E8%AE%B0\/point\/flannel\/"},"genre":"posts","keywords":"point, Flannel","wordcount":3512,"url":"https:\/\/kentxxq.com\/posts\/%E7%AC%94%E8%AE%B0\/point\/flannel\/","datePublished":"2023-11-24T00:00:00+00:00","dateModified":"2023-11-24T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"kentxxq"},"description":""}</script><script src=//instant.page/5.2.0 defer type=module integrity=sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z></script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else""==="light"||""==="dark"||""==="black"?(setTheme(""),saveTheme("")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=运维个人技术栈>运维个人技术栈</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Blog </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/about/>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=运维个人技术栈>运维个人技术栈</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>Blog</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#53-flannel>5.3 Flannel</a><ul><li><a href=#531-overlay-network-介绍>5.3.1 overlay network 介绍</a></li><li><a href=#532-flannel-介绍>5.3.2 Flannel 介绍</a></li><li><a href=#533-flannel-工作原理>5.3.3 Flannel 工作原理</a></li></ul></li><li><a href=#54-etcd>5.4 ETCD</a></li><li><a href=#55-etcd-部署>5.5 ETCD 部署</a><ul><li><a href=#551-主机名称配置>5.5.1 主机名称配置</a></li><li><a href=#552-主机-ip-地址配置>5.5.2 主机 IP 地址配置</a></li><li><a href=#553-主机名与-ip-地址解析>5.5.3 主机名与 IP 地址解析</a></li><li><a href=#554-开启内核转发>5.5.4 开启内核转发</a></li><li><a href=#555-etcd-安装>5.5.5 etcd 安装</a></li><li><a href=#556-etcd-配置>5.5.6 etcd 配置</a></li><li><a href=#557-启动-etcd-服务>5.5.7 启动 etcd 服务</a></li><li><a href=#558-检查端口状态>5.5.8 检查端口状态</a></li><li><a href=#559-检查-etcd-集群是否健康>5.5.9 检查 etcd 集群是否健康</a></li></ul></li><li><a href=#56-flannel-部署>5.6 Flannel 部署</a><ul><li><a href=#561-flannel-安装>5.6.1 Flannel 安装</a></li><li><a href=#562-修改-flannel-配置文件>5.6.2 修改 Flannel 配置文件</a></li><li><a href=#563-配置-etcd-中关于-flannel-的-key>5.6.3 配置 etcd 中关于 flannel 的 key</a></li><li><a href=#564-启动-flannel-服务>5.6.4 启动 Flannel 服务</a></li><li><a href=#565-查看各-node-中-flannel-产生的配置信息>5.6.5 查看各 node 中 flannel 产生的配置信息</a></li></ul></li><li><a href=#57-docker-网络配置>5.7 Docker 网络配置</a></li><li><a href=#58-跨-docker-host-容器间通信验证>5.8 跨 Docker Host 容器间通信验证</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Flannel</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class="author fas fa-user-circle fa-fw"></span><a href=https://kentxxq.com title=Author target=_blank rel="noopener noreferrer author" class=author>kentxxq</a>
</span>&nbsp;<span class=post-category>收录于 </span>&nbsp;<span class=post-category>类别 <a href=/categories/point/><i class="far fa-folder fa-fw"></i>point</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2023-11-24>2023-11-24</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2023-11-24>2023-11-24</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3512 字&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 8 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#53-flannel>5.3 Flannel</a><ul><li><a href=#531-overlay-network-介绍>5.3.1 overlay network 介绍</a></li><li><a href=#532-flannel-介绍>5.3.2 Flannel 介绍</a></li><li><a href=#533-flannel-工作原理>5.3.3 Flannel 工作原理</a></li></ul></li><li><a href=#54-etcd>5.4 ETCD</a></li><li><a href=#55-etcd-部署>5.5 ETCD 部署</a><ul><li><a href=#551-主机名称配置>5.5.1 主机名称配置</a></li><li><a href=#552-主机-ip-地址配置>5.5.2 主机 IP 地址配置</a></li><li><a href=#553-主机名与-ip-地址解析>5.5.3 主机名与 IP 地址解析</a></li><li><a href=#554-开启内核转发>5.5.4 开启内核转发</a></li><li><a href=#555-etcd-安装>5.5.5 etcd 安装</a></li><li><a href=#556-etcd-配置>5.5.6 etcd 配置</a></li><li><a href=#557-启动-etcd-服务>5.5.7 启动 etcd 服务</a></li><li><a href=#558-检查端口状态>5.5.8 检查端口状态</a></li><li><a href=#559-检查-etcd-集群是否健康>5.5.9 检查 etcd 集群是否健康</a></li></ul></li><li><a href=#56-flannel-部署>5.6 Flannel 部署</a><ul><li><a href=#561-flannel-安装>5.6.1 Flannel 安装</a></li><li><a href=#562-修改-flannel-配置文件>5.6.2 修改 Flannel 配置文件</a></li><li><a href=#563-配置-etcd-中关于-flannel-的-key>5.6.3 配置 etcd 中关于 flannel 的 key</a></li><li><a href=#564-启动-flannel-服务>5.6.4 启动 Flannel 服务</a></li><li><a href=#565-查看各-node-中-flannel-产生的配置信息>5.6.5 查看各 node 中 flannel 产生的配置信息</a></li></ul></li><li><a href=#57-docker-网络配置>5.7 Docker 网络配置</a></li><li><a href=#58-跨-docker-host-容器间通信验证>5.8 跨 Docker Host 容器间通信验证</a></li></ul></nav></div></div><div class=content id=content><h2 id=53-flannel class=headerLink><a href=#53-flannel class=header-mark></a>5.3 Flannel</h2><h3 id=531-overlay-network-介绍 class=headerLink><a href=#531-overlay-network-%e4%bb%8b%e7%bb%8d class=header-mark></a>5.3.1 overlay network 介绍</h3><p>Overlay 网络是指在不改变现有网络基础设施的前提下，通过某种约定通信协议，把二层报文封装在 IP 报文之上的新的数据格式。这样不但能够充分利用成熟的 IP 路由协议进程数据分发；而且在 Overlay 技术中采用扩展的隔离标识位数，能够突破 VLAN 的 4000 数量限制支持高达 16M 的用户，并在必要时可将广播流量转化为组播流量，避免广播数据泛滥。</p><p>因此，Overlay 网络实际上是目前最主流的容器跨节点数据传输和路由方案。</p><h3 id=532-flannel-介绍 class=headerLink><a href=#532-flannel-%e4%bb%8b%e7%bb%8d class=header-mark></a>5.3.2 Flannel 介绍</h3><p>Flannel 是 CoreOS 团队针对 Kubernetes 设计的一个覆盖网络（Overlay Network）工具，其目的在于帮助每一个使用 Kuberentes 的 CoreOS 主机拥有一个完整的子网。 Flannel 通过给每台宿主机分配一个子网的方式为容器提供虚拟网络，它基于 Linux TUN/TAP，使用 UDP 封装 IP 包来创建 overlay 网络，并借助 etcd 维护网络的分配情况。 Flannel is a simple and easy way to configure a layer 3 network fabric designed for Kubernetes.</p><h3 id=533-flannel-工作原理 class=headerLink><a href=#533-flannel-%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86 class=header-mark></a>5.3.3 Flannel 工作原理</h3><p>Flannel 是 CoreOS 团队针对 Kubernetes 设计的一个网络规划服务，简单来说，它的功能是让集群中的不同节点主机创建的 Docker 容器都具有全集群唯一的虚拟 IP 地址。但在默认的 Docker 配置中，每个 Node 的 Docker 服务会分别负责所在节点容器的 IP 分配。Node 内部的容器之间可以相互访问,但是跨主机 (Node) 网络相互间是不能通信。Flannel 设计目的就是为集群中所有节点重新规划 IP 地址的使用规则，从而使得不同节点上的容器能够获得 " 同属一个内网 " 且 " 不重复的 &ldquo;IP 地址，并让属于不同节点上的容器能够直接通过内网 IP 通信。 Flannel 使用 etcd 存储配置数据和子网分配信息。flannel 启动之后，后台进程首先检索配置和正在使用的子网列表，然后选择一个可用的子网，然后尝试去注册它。etcd 也存储这个每个主机对应的 ip。flannel 使用 etcd 的 watch 机制监视 <code>/coreos.com/network/subnets</code> 下面所有元素的变化信息，并且根据它来维护一个路由表。为了提高性能，flannel 优化了 Universal TAP/TUN 设备，对 TUN 和 UDP 之间的 ip 分片做了代理。 如下原理图：</p><p><img src=/posts/%E9%99%84%E4%BB%B6/Flannel%E9%80%9A%E4%BF%A1%E7%A4%BA%E6%84%8F%E5%9B%BE.png></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>1、数据从源容器中发出后，经由所在主机的docker0虚拟网卡转发到flannel0虚拟网卡，这是个P2P的虚拟网卡，flanneld服务监听在网卡的另外一端。
</span></span><span class=line><span class=cl>2、Flannel通过Etcd服务维护了一张节点间的路由表，该张表里保存了各个节点主机的子网网段信息。
</span></span><span class=line><span class=cl>3、源主机的flanneld服务将原本的数据内容UDP封装后根据自己的路由表投递给目的节点的flanneld服务，数据到达以后被解包，然后直接进入目的节点的flannel0虚拟网卡，然后被转发到目的主机的docker0虚拟网卡，最后就像本机容器通信一样的由docker0路由到达目标容器。
</span></span></code></pre></td></tr></table></div></div><h2 id=54-etcd class=headerLink><a href=#54-etcd class=header-mark></a>5.4 ETCD</h2><p>etcd 是 CoreOS 团队于 2013 年 6 月发起的开源项目，它的目标是构建一个高可用的分布式键值 (key-value) 数据库。etcd 内部采用 <code>raft</code> 协议作为一致性算法，etcd 基于 Go 语言实现。</p><p>etcd 作为服务发现系统，特点：</p><ul><li>简单：安装配置简单，而且提供了 HTTP API 进行交互，使用也很简单</li><li>安全：支持 SSL 证书验证</li><li>快速：根据官方提供的 benchmark 数据，单实例支持每秒 2k+ 读操作</li><li>可靠：采用 raft 算法，实现分布式系统数据的可用性和一致性</li></ul><h2 id=55-etcd-部署 class=headerLink><a href=#55-etcd-%e9%83%a8%e7%bd%b2 class=header-mark></a>5.5 ETCD 部署</h2><blockquote><p>主机防火墙及 SELINUX 均关闭。</p></blockquote><h3 id=551-主机名称配置 class=headerLink><a href=#551-%e4%b8%bb%e6%9c%ba%e5%90%8d%e7%a7%b0%e9%85%8d%e7%bd%ae class=header-mark></a>5.5.1 主机名称配置</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># hostnamectl set-hostname node1</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># hostnamectl set-hostname node2</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=552-主机-ip-地址配置 class=headerLink><a href=#552-%e4%b8%bb%e6%9c%ba-ip-%e5%9c%b0%e5%9d%80%e9%85%8d%e7%bd%ae class=header-mark></a>5.5.2 主机 IP 地址配置</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># vim /etc/sysconfig/network-scripts/ifcfg-ens33</span>
</span></span><span class=line><span class=cl><span class=c># cat /etc/sysconfig/network-scripts/ifcfg-ens33</span>
</span></span><span class=line><span class=cl><span class=n>TYPE</span><span class=p>=</span><span class=s2>&#34;Ethernet&#34;</span>
</span></span><span class=line><span class=cl><span class=n>PROXY_METHOD</span><span class=p>=</span><span class=s2>&#34;none&#34;</span>
</span></span><span class=line><span class=cl><span class=n>BROWSER_ONLY</span><span class=p>=</span><span class=s2>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=n>BOOTPROTO</span><span class=p>=</span><span class=s2>&#34;none&#34;</span>
</span></span><span class=line><span class=cl><span class=n>DEFROUTE</span><span class=p>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=n>IPV4_FAILURE_FATAL</span><span class=p>=</span><span class=s2>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=n>IPV6INIT</span><span class=p>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=n>IPV6_AUTOCONF</span><span class=p>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=n>IPV6_DEFROUTE</span><span class=p>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=n>IPV6_FAILURE_FATAL</span><span class=p>=</span><span class=s2>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=n>IPV6_ADDR_GEN_MODE</span><span class=p>=</span><span class=s2>&#34;stable-privacy&#34;</span>
</span></span><span class=line><span class=cl><span class=n>NAME</span><span class=p>=</span><span class=s2>&#34;ens33&#34;</span>
</span></span><span class=line><span class=cl><span class=n>UUID</span><span class=p>=</span><span class=s2>&#34;6c020cf7-4c6e-4276-9aa6-0661670da705&#34;</span>
</span></span><span class=line><span class=cl><span class=n>DEVICE</span><span class=p>=</span><span class=s2>&#34;ens33&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ONBOOT</span><span class=p>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=n>IPADDR</span><span class=p>=</span><span class=s2>&#34;192.168.255.154&#34;</span>
</span></span><span class=line><span class=cl><span class=n>PREFIX</span><span class=p>=</span><span class=s2>&#34;24&#34;</span>
</span></span><span class=line><span class=cl><span class=n>GATEWAY</span><span class=p>=</span><span class=s2>&#34;192.168.255.2&#34;</span>
</span></span><span class=line><span class=cl><span class=n>DNS1</span><span class=p>=</span><span class=s2>&#34;119.29.29.29&#34;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># vim /etc/sysconfig/network-scripts/ifcfg-ens33</span>
</span></span><span class=line><span class=cl><span class=c># cat /etc/sysconfig/network-scripts/ifcfg-ens33</span>
</span></span><span class=line><span class=cl><span class=n>TYPE</span><span class=p>=</span><span class=s2>&#34;Ethernet&#34;</span>
</span></span><span class=line><span class=cl><span class=n>PROXY_METHOD</span><span class=p>=</span><span class=s2>&#34;none&#34;</span>
</span></span><span class=line><span class=cl><span class=n>BROWSER_ONLY</span><span class=p>=</span><span class=s2>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=n>BOOTPROTO</span><span class=p>=</span><span class=s2>&#34;none&#34;</span>
</span></span><span class=line><span class=cl><span class=n>DEFROUTE</span><span class=p>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=n>IPV4_FAILURE_FATAL</span><span class=p>=</span><span class=s2>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=n>IPV6INIT</span><span class=p>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=n>IPV6_AUTOCONF</span><span class=p>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=n>IPV6_DEFROUTE</span><span class=p>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=n>IPV6_FAILURE_FATAL</span><span class=p>=</span><span class=s2>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=n>IPV6_ADDR_GEN_MODE</span><span class=p>=</span><span class=s2>&#34;stable-privacy&#34;</span>
</span></span><span class=line><span class=cl><span class=n>NAME</span><span class=p>=</span><span class=s2>&#34;ens33&#34;</span>
</span></span><span class=line><span class=cl><span class=n>UUID</span><span class=p>=</span><span class=s2>&#34;6c020cf7-4c6e-4276-9aa6-0661670da705&#34;</span>
</span></span><span class=line><span class=cl><span class=n>DEVICE</span><span class=p>=</span><span class=s2>&#34;ens33&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ONBOOT</span><span class=p>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=n>IPADDR</span><span class=p>=</span><span class=s2>&#34;192.168.255.155&#34;</span>
</span></span><span class=line><span class=cl><span class=n>PREFIX</span><span class=p>=</span><span class=s2>&#34;24&#34;</span>
</span></span><span class=line><span class=cl><span class=n>GATEWAY</span><span class=p>=</span><span class=s2>&#34;192.168.255.2&#34;</span>
</span></span><span class=line><span class=cl><span class=n>DNS1</span><span class=p>=</span><span class=s2>&#34;119.29.29.29&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=553-主机名与-ip-地址解析 class=headerLink><a href=#553-%e4%b8%bb%e6%9c%ba%e5%90%8d%e4%b8%8e-ip-%e5%9c%b0%e5%9d%80%e8%a7%a3%e6%9e%90 class=header-mark></a>5.5.3 主机名与 IP 地址解析</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># vim /etc/hosts</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># cat /etc/hosts</span>
</span></span><span class=line><span class=cl><span class=mf>127.0</span><span class=p>.</span><span class=py>0</span><span class=p>.</span><span class=py>1</span>   <span class=n>localhost</span> <span class=n>localhost</span><span class=p>.</span><span class=py>localdomain</span> <span class=n>localhost4</span> <span class=n>localhost4</span><span class=p>.</span><span class=py>localdomain4</span>
</span></span><span class=line><span class=cl><span class=p>::</span><span class=mf>1</span>         <span class=n>localhost</span> <span class=n>localhost</span><span class=p>.</span><span class=py>localdomain</span> <span class=n>localhost6</span> <span class=n>localhost6</span><span class=p>.</span><span class=py>localdomain6</span>
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=py>154</span> <span class=n>node1</span>
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=py>155</span> <span class=n>node2</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># vim /etc/hosts</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># cat /etc/hosts</span>
</span></span><span class=line><span class=cl><span class=mf>127.0</span><span class=p>.</span><span class=py>0</span><span class=p>.</span><span class=py>1</span>   <span class=n>localhost</span> <span class=n>localhost</span><span class=p>.</span><span class=py>localdomain</span> <span class=n>localhost4</span> <span class=n>localhost4</span><span class=p>.</span><span class=py>localdomain4</span>
</span></span><span class=line><span class=cl><span class=p>::</span><span class=mf>1</span>         <span class=n>localhost</span> <span class=n>localhost</span><span class=p>.</span><span class=py>localdomain</span> <span class=n>localhost6</span> <span class=n>localhost6</span><span class=p>.</span><span class=py>localdomain6</span>
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=py>154</span> <span class=n>node1</span>
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=py>155</span> <span class=n>node2</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=554-开启内核转发 class=headerLink><a href=#554-%e5%bc%80%e5%90%af%e5%86%85%e6%a0%b8%e8%bd%ac%e5%8f%91 class=header-mark></a>5.5.4 开启内核转发</h3><blockquote><p>所有 Docker Host</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># vim /etc/sysctl.conf</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># cat /etc/sysctl.conf</span>
</span></span><span class=line><span class=cl><span class=p>......</span>
</span></span><span class=line><span class=cl><span class=n>net</span><span class=p>.</span><span class=py>ipv4</span><span class=p>.</span><span class=n>ip_forward</span><span class=p>=</span><span class=mf>1</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># sysctl -p</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># vim /etc/sysctl.conf</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># cat /etc/sysctl.conf</span>
</span></span><span class=line><span class=cl><span class=p>......</span>
</span></span><span class=line><span class=cl><span class=n>net</span><span class=p>.</span><span class=py>ipv4</span><span class=p>.</span><span class=n>ip_forward</span><span class=p>=</span><span class=mf>1</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># sysctl -p</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=555-etcd-安装 class=headerLink><a href=#555-etcd-%e5%ae%89%e8%a3%85 class=header-mark></a>5.5.5 etcd 安装</h3><blockquote><p>etcd 集群</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># yum -y install etcd</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># yum -y install etcd</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=556-etcd-配置 class=headerLink><a href=#556-etcd-%e9%85%8d%e7%bd%ae class=header-mark></a>5.5.6 etcd 配置</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># vim /etc/etcd/etcd.conf</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># cat /etc/etcd/etcd.conf</span>
</span></span><span class=line><span class=cl><span class=c>#[Member]</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_CORS=&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ETCD_DATA_DIR</span><span class=p>=</span><span class=s2>&#34;/var/lib/etcd/node1.etcd&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_WAL_DIR=&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ETCD_LISTEN_PEER_URLS</span><span class=p>=</span><span class=s2>&#34;http://0.0.0.0:2380&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ETCD_LISTEN_CLIENT_URLS</span><span class=p>=</span><span class=s2>&#34;http://0.0.0.0:2379,http://0.0.0.0:4001&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_MAX_SNAPSHOTS=&#34;5&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_MAX_WALS=&#34;5&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ETCD_NAME</span><span class=p>=</span><span class=s2>&#34;node1&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_SNAPSHOT_COUNT=&#34;100000&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_HEARTBEAT_INTERVAL=&#34;100&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_ELECTION_TIMEOUT=&#34;1000&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_QUOTA_BACKEND_BYTES=&#34;0&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_MAX_REQUEST_BYTES=&#34;1572864&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_GRPC_KEEPALIVE_MIN_TIME=&#34;5s&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_GRPC_KEEPALIVE_INTERVAL=&#34;2h0m0s&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_GRPC_KEEPALIVE_TIMEOUT=&#34;20s&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#</span>
</span></span><span class=line><span class=cl><span class=c>#[Clustering]</span>
</span></span><span class=line><span class=cl><span class=n>ETCD_INITIAL_ADVERTISE_PEER_URLS</span><span class=p>=</span><span class=s2>&#34;http://192.168.255.154:2380&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ETCD_ADVERTISE_CLIENT_URLS</span><span class=p>=</span><span class=s2>&#34;http://192.168.255.154:2379,http://192.168.255.155:4001&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_DISCOVERY=&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_DISCOVERY_FALLBACK=&#34;proxy&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_DISCOVERY_PROXY=&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_DISCOVERY_SRV=&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ETCD_INITIAL_CLUSTER</span><span class=p>=</span><span class=s2>&#34;node1=http://192.168.255.154:2380,node2=http://192.168.255.155:2380&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_INITIAL_CLUSTER_TOKEN=&#34;etcd-cluster&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_INITIAL_CLUSTER_STATE=&#34;new&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_STRICT_RECONFIG_CHECK=&#34;true&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_ENABLE_V2=&#34;true&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#</span>
</span></span><span class=line><span class=cl><span class=c>#[Proxy]</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># vim /etc/etcd/etcd.conf</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># cat /etc/etcd/etcd.conf</span>
</span></span><span class=line><span class=cl><span class=c>#[Member]</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_CORS=&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ETCD_DATA_DIR</span><span class=p>=</span><span class=s2>&#34;/var/lib/etcd/node2.etcd&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_WAL_DIR=&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ETCD_LISTEN_PEER_URLS</span><span class=p>=</span><span class=s2>&#34;http://0.0.0.0:2380&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ETCD_LISTEN_CLIENT_URLS</span><span class=p>=</span><span class=s2>&#34;http://0.0.0.0:2379,http://0.0.0.0:4001&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_MAX_SNAPSHOTS=&#34;5&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_MAX_WALS=&#34;5&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ETCD_NAME</span><span class=p>=</span><span class=s2>&#34;node2&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_SNAPSHOT_COUNT=&#34;100000&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_HEARTBEAT_INTERVAL=&#34;100&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_ELECTION_TIMEOUT=&#34;1000&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_QUOTA_BACKEND_BYTES=&#34;0&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_MAX_REQUEST_BYTES=&#34;1572864&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_GRPC_KEEPALIVE_MIN_TIME=&#34;5s&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_GRPC_KEEPALIVE_INTERVAL=&#34;2h0m0s&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_GRPC_KEEPALIVE_TIMEOUT=&#34;20s&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#</span>
</span></span><span class=line><span class=cl><span class=c>#[Clustering]</span>
</span></span><span class=line><span class=cl><span class=n>ETCD_INITIAL_ADVERTISE_PEER_URLS</span><span class=p>=</span><span class=s2>&#34;http://192.168.255.155:2380&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ETCD_ADVERTISE_CLIENT_URLS</span><span class=p>=</span><span class=s2>&#34;http://192.168.255.155:2379,http://192.168.255.155:4001&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_DISCOVERY=&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_DISCOVERY_FALLBACK=&#34;proxy&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_DISCOVERY_PROXY=&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_DISCOVERY_SRV=&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ETCD_INITIAL_CLUSTER</span><span class=p>=</span><span class=s2>&#34;node1=http://192.168.255.154:2380,node2=http://192.168.255.155:2380&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_INITIAL_CLUSTER_TOKEN=&#34;etcd-cluster&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_INITIAL_CLUSTER_STATE=&#34;new&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_STRICT_RECONFIG_CHECK=&#34;true&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#ETCD_ENABLE_V2=&#34;true&#34;</span>
</span></span><span class=line><span class=cl><span class=c>#</span>
</span></span><span class=line><span class=cl><span class=c>#[Proxy]</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=557-启动-etcd-服务 class=headerLink><a href=#557-%e5%90%af%e5%8a%a8-etcd-%e6%9c%8d%e5%8a%a1 class=header-mark></a>5.5.7 启动 etcd 服务</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># systemctl enable etcd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># systemctl start etcd</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># systemctl enable etcd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># systemctl start etcd</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=558-检查端口状态 class=headerLink><a href=#558-%e6%a3%80%e6%9f%a5%e7%ab%af%e5%8f%a3%e7%8a%b6%e6%80%81 class=header-mark></a>5.5.8 检查端口状态</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># netstat -tnlp | grep -E  &#34;4001|2380&#34;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=err>输出结果：</span>
</span></span><span class=line><span class=cl><span class=n>tcp6</span>       <span class=mf>0</span>      <span class=mf>0</span> <span class=p>::</span><span class=err>:</span><span class=mf>2380</span>                 <span class=p>::</span><span class=err>:</span><span class=p>*</span>                    <span class=n>LISTEN</span>      <span class=mf>65318</span><span class=p>/</span><span class=n>etcd</span>
</span></span><span class=line><span class=cl><span class=n>tcp6</span>       <span class=mf>0</span>      <span class=mf>0</span> <span class=p>::</span><span class=err>:</span><span class=mf>4001</span>                 <span class=p>::</span><span class=err>:</span><span class=p>*</span>                    <span class=n>LISTEN</span>      <span class=mf>65318</span><span class=p>/</span><span class=n>etcd</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=559-检查-etcd-集群是否健康 class=headerLink><a href=#559-%e6%a3%80%e6%9f%a5-etcd-%e9%9b%86%e7%be%a4%e6%98%af%e5%90%a6%e5%81%a5%e5%ba%b7 class=header-mark></a>5.5.9 检查 etcd 集群是否健康</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># etcdctl -C http://192.168.255.154:2379 cluster-health</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=err>输出：</span>
</span></span><span class=line><span class=cl><span class=n>member</span> <span class=n>5be09658727c5574</span> <span class=n>is</span> <span class=n>healthy</span><span class=err>:</span> <span class=n>got</span> <span class=n>healthy</span> <span class=n>result</span> <span class=n>from</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=mf>192.168</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=mf>154</span><span class=err>:</span><span class=mf>2379</span>
</span></span><span class=line><span class=cl><span class=n>member</span> <span class=n>c48e6c7a65e5ca43</span> <span class=n>is</span> <span class=n>healthy</span><span class=err>:</span> <span class=n>got</span> <span class=n>healthy</span> <span class=n>result</span> <span class=n>from</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=mf>192.168</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=mf>155</span><span class=err>:</span><span class=mf>2379</span>
</span></span><span class=line><span class=cl><span class=n>cluster</span> <span class=n>is</span> <span class=n>healthy</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># etcdctl member list</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=err>输出：</span>
</span></span><span class=line><span class=cl><span class=n>5be09658727c5574</span><span class=err>:</span> <span class=n>name</span><span class=p>=</span><span class=n>node1</span> <span class=n>peerURLs</span><span class=p>=</span><span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=mf>192.168</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=mf>154</span><span class=err>:</span><span class=mf>2380</span> <span class=n>clientURLs</span><span class=p>=</span><span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=mf>192.168</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=mf>154</span><span class=err>:</span><span class=mf>2379</span><span class=p>,</span><span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=mf>192.168</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=mf>155</span><span class=err>:</span><span class=mf>4001</span> <span class=n>isLeader</span><span class=p>=</span><span class=n>true</span>
</span></span><span class=line><span class=cl><span class=n>c48e6c7a65e5ca43</span><span class=err>:</span> <span class=n>name</span><span class=p>=</span><span class=n>node2</span> <span class=n>peerURLs</span><span class=p>=</span><span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=mf>192.168</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=mf>155</span><span class=err>:</span><span class=mf>2380</span> <span class=n>clientURLs</span><span class=p>=</span><span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=mf>192.168</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=mf>155</span><span class=err>:</span><span class=mf>2379</span><span class=p>,</span><span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=mf>192.168</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=mf>155</span><span class=err>:</span><span class=mf>4001</span> <span class=n>isLeader</span><span class=p>=</span><span class=n>false</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=56-flannel-部署 class=headerLink><a href=#56-flannel-%e9%83%a8%e7%bd%b2 class=header-mark></a>5.6 Flannel 部署</h2><h3 id=561-flannel-安装 class=headerLink><a href=#561-flannel-%e5%ae%89%e8%a3%85 class=header-mark></a>5.6.1 Flannel 安装</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># yum -y install flannel</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># yum -y install flannel</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=562-修改-flannel-配置文件 class=headerLink><a href=#562-%e4%bf%ae%e6%94%b9-flannel-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 class=header-mark></a>5.6.2 修改 Flannel 配置文件</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># vim /etc/sysconfig/flanneld</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># cat /etc/sysconfig/flanneld</span>
</span></span><span class=line><span class=cl><span class=c># Flanneld configuration options</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># etcd url location.  Point this to the server where etcd runs</span>
</span></span><span class=line><span class=cl><span class=n>FLANNEL_ETCD_ENDPOINTS</span><span class=p>=</span><span class=s2>&#34;http://192.168.255.154:2379,http://192.168.255.155:2379&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># etcd config key.  This is the configuration key that flannel queries</span>
</span></span><span class=line><span class=cl><span class=c># For address range assignment</span>
</span></span><span class=line><span class=cl><span class=n>FLANNEL_ETCD_PREFIX</span><span class=p>=</span><span class=s2>&#34;/atomic.io/network&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Any additional options that you want to pass</span>
</span></span><span class=line><span class=cl><span class=c>#FLANNEL_OPTIONS=&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>FLANNEL_OPTIONS</span><span class=p>=</span><span class=s2>&#34;--logtostderr=false --log_dir=/var/log/ --etcd endpoints=http://192.168.255.154:2379,http://192.168.255.155:2379 --iface=ens33&#34;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># vim /etc/sysconfig/flanneld</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># cat /etc/sysconfig/flanneld</span>
</span></span><span class=line><span class=cl><span class=c># Flanneld configuration options</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># etcd url location.  Point this to the server where etcd runs</span>
</span></span><span class=line><span class=cl><span class=n>FLANNEL_ETCD_ENDPOINTS</span><span class=p>=</span><span class=s2>&#34;http://192.168.255.154:2379,http://192.168.255.155:2379&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># etcd config key.  This is the configuration key that flannel queries</span>
</span></span><span class=line><span class=cl><span class=c># For address range assignment</span>
</span></span><span class=line><span class=cl><span class=n>FLANNEL_ETCD_PREFIX</span><span class=p>=</span><span class=s2>&#34;/atomic.io/network&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Any additional options that you want to pass</span>
</span></span><span class=line><span class=cl><span class=c>#FLANNEL_OPTIONS=&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>FLANNEL_OPTIONS</span><span class=p>=</span><span class=s2>&#34;--logtostderr=false --log_dir=/var/log/ --etcd-endpoints=http://192.168.255.154:2379,http://192.168.255.155:2379 --iface=ens33&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=563-配置-etcd-中关于-flannel-的-key class=headerLink><a href=#563-%e9%85%8d%e7%bd%ae-etcd-%e4%b8%ad%e5%85%b3%e4%ba%8e-flannel-%e7%9a%84-key class=header-mark></a>5.6.3 配置 etcd 中关于 flannel 的 key</h3><p>Flannel 使用 Etcd 进行配置，来保证多个 Flannel 实例之间的配置一致性，所以需要在 etcd 上进行如下配置（<strong>&rsquo;/<a href="https://link.zhihu.com/?target=http%3A//atomic.io/network/config" target=_blank rel="noopener noreferrer">http://atomic.io/network/config</a></strong>&rsquo; 这个 key 与上面的/etc/sysconfig/flannel 中的配置项 FLANNEL_ETCD_PREFIX 是相对应的，错误的话启动就会出错）</p><blockquote><p>该 ip 网段可以任意设定，随便设定一个网段都可以。容器的 ip 就是根据这个网段进行自动分配的，ip 分配后，容器一般是可以对外联网的（网桥模式，只要 Docker Host 能上网即可。）</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># etcdctl mk /atomic.io/network/config &#39;{&#34;Network&#34;:&#34;172.21.0.0/16&#34;}&#39;</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=s2>&#34;Network&#34;</span><span class=err>:</span><span class=s2>&#34;172.21.0.0/16&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>或</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># etcdctl set /atomic.io/network/config &#39;{&#34;Network&#34;:&#34;172.21.0.0/16&#34;}&#39;</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=s2>&#34;Network&#34;</span><span class=err>:</span><span class=s2>&#34;172.21.0.0/16&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># etcdctl get /atomic.io/network/config</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=s2>&#34;Network&#34;</span><span class=err>:</span><span class=s2>&#34;172.21.0.0/16&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=564-启动-flannel-服务 class=headerLink><a href=#564-%e5%90%af%e5%8a%a8-flannel-%e6%9c%8d%e5%8a%a1 class=header-mark></a>5.6.4 启动 Flannel 服务</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># systemctl enable flanneld;systemctl start flanneld</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># systemctl enable flanneld;systemctl start flanneld</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=565-查看各-node-中-flannel-产生的配置信息 class=headerLink><a href=#565-%e6%9f%a5%e7%9c%8b%e5%90%84-node-%e4%b8%ad-flannel-%e4%ba%a7%e7%94%9f%e7%9a%84%e9%85%8d%e7%bd%ae%e4%bf%a1%e6%81%af class=header-mark></a>5.6.5 查看各 node 中 flannel 产生的配置信息</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># ls /run/flannel/</span>
</span></span><span class=line><span class=cl><span class=n>docker</span>  <span class=n>subnet</span><span class=p>.</span><span class=py>env</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># cat /run/flannel/subnet.env</span>
</span></span><span class=line><span class=cl><span class=n>FLANNEL_NETWORK</span><span class=p>=</span><span class=mf>172.21</span><span class=p>.</span><span class=py>0</span><span class=p>.</span><span class=mf>0</span><span class=p>/</span><span class=mf>16</span>
</span></span><span class=line><span class=cl><span class=n>FLANNEL_SUBNET</span><span class=p>=</span><span class=mf>172.21</span><span class=p>.</span><span class=py>31</span><span class=p>.</span><span class=mf>1</span><span class=p>/</span><span class=mf>24</span>
</span></span><span class=line><span class=cl><span class=n>FLANNEL_MTU</span><span class=p>=</span><span class=mf>1472</span>
</span></span><span class=line><span class=cl><span class=n>FLANNEL_IPMASQ</span><span class=p>=</span><span class=n>false</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># ip a s</span>
</span></span><span class=line><span class=cl><span class=p>......</span>
</span></span><span class=line><span class=cl><span class=mf>5</span><span class=err>:</span> <span class=n>docker0</span><span class=err>:</span> <span class=p>&lt;</span><span class=nb>NO-CARRIER</span><span class=p>,</span><span class=n>BROADCAST</span><span class=p>,</span><span class=n>MULTICAST</span><span class=p>,</span><span class=n>UP</span><span class=p>&gt;</span> <span class=n>mtu</span> <span class=mf>1500</span> <span class=n>qdisc</span> <span class=n>noqueue</span> <span class=n>state</span> <span class=n>DOWN</span> <span class=nb>group </span><span class=k>default</span>
</span></span><span class=line><span class=cl>    <span class=n>link</span><span class=p>/</span><span class=n>ether</span> <span class=mf>02</span><span class=err>:</span><span class=mf>42</span><span class=err>:</span><span class=mf>63</span><span class=err>:</span><span class=n>d1</span><span class=err>:</span><span class=n>9e</span><span class=err>:</span><span class=n>0b</span> <span class=n>brd</span> <span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span>
</span></span><span class=line><span class=cl>    <span class=n>inet</span> <span class=mf>172.17</span><span class=p>.</span><span class=py>0</span><span class=p>.</span><span class=mf>1</span><span class=p>/</span><span class=mf>16</span> <span class=n>brd</span> <span class=mf>172.17</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=py>255</span> <span class=n>scope</span> <span class=n>global</span> <span class=n>docker0</span>
</span></span><span class=line><span class=cl>       <span class=n>valid_lft</span> <span class=n>forever</span> <span class=n>preferred_lft</span> <span class=n>forever</span>
</span></span><span class=line><span class=cl><span class=mf>6</span><span class=err>:</span> <span class=n>flannel0</span><span class=err>:</span> <span class=p>&lt;</span><span class=n>POINTOPOINT</span><span class=p>,</span><span class=n>MULTICAST</span><span class=p>,</span><span class=n>NOARP</span><span class=p>,</span><span class=n>UP</span><span class=p>,</span><span class=n>LOWER_UP</span><span class=p>&gt;</span> <span class=n>mtu</span> <span class=mf>1472</span> <span class=n>qdisc</span> <span class=n>pfifo_fast</span> <span class=n>state</span> <span class=n>UNKNOWN</span> <span class=nb>group </span><span class=k>default</span> <span class=n>qlen</span> <span class=mf>500</span>
</span></span><span class=line><span class=cl>    <span class=n>link</span><span class=p>/</span><span class=n>none</span>
</span></span><span class=line><span class=cl>    <span class=n>inet</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>31</span><span class=p>.</span><span class=mf>0</span><span class=p>/</span><span class=mf>16</span> <span class=n>scope</span> <span class=n>global</span> <span class=n>flannel0</span>
</span></span><span class=line><span class=cl>       <span class=n>valid_lft</span> <span class=n>forever</span> <span class=n>preferred_lft</span> <span class=n>forever</span>
</span></span><span class=line><span class=cl>    <span class=n>inet6</span> <span class=n>fe80</span><span class=p>::</span><span class=n>edfa</span><span class=err>:</span><span class=n>d8b0</span><span class=err>:</span><span class=mf>3351</span><span class=err>:</span><span class=mf>4126</span><span class=p>/</span><span class=mf>64</span> <span class=n>scope</span> <span class=n>link</span> <span class=n>flags</span> <span class=mf>800</span>
</span></span><span class=line><span class=cl>       <span class=n>valid_lft</span> <span class=n>forever</span> <span class=n>preferred_lft</span> <span class=n>forever</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># ls /run/flannel/</span>
</span></span><span class=line><span class=cl><span class=n>docker</span>  <span class=n>subnet</span><span class=p>.</span><span class=py>env</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># cat /run/flannel/subnet.env</span>
</span></span><span class=line><span class=cl><span class=n>FLANNEL_NETWORK</span><span class=p>=</span><span class=mf>172.21</span><span class=p>.</span><span class=py>0</span><span class=p>.</span><span class=mf>0</span><span class=p>/</span><span class=mf>16</span>
</span></span><span class=line><span class=cl><span class=n>FLANNEL_SUBNET</span><span class=p>=</span><span class=mf>172.21</span><span class=p>.</span><span class=py>55</span><span class=p>.</span><span class=mf>1</span><span class=p>/</span><span class=mf>24</span>
</span></span><span class=line><span class=cl><span class=n>FLANNEL_MTU</span><span class=p>=</span><span class=mf>1472</span>
</span></span><span class=line><span class=cl><span class=n>FLANNEL_IPMASQ</span><span class=p>=</span><span class=n>false</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># ip a s</span>
</span></span><span class=line><span class=cl><span class=p>......</span>
</span></span><span class=line><span class=cl><span class=mf>5</span><span class=err>:</span> <span class=n>docker0</span><span class=err>:</span> <span class=p>&lt;</span><span class=nb>NO-CARRIER</span><span class=p>,</span><span class=n>BROADCAST</span><span class=p>,</span><span class=n>MULTICAST</span><span class=p>,</span><span class=n>UP</span><span class=p>&gt;</span> <span class=n>mtu</span> <span class=mf>1500</span> <span class=n>qdisc</span> <span class=n>noqueue</span> <span class=n>state</span> <span class=n>DOWN</span> <span class=nb>group </span><span class=k>default</span>
</span></span><span class=line><span class=cl>    <span class=n>link</span><span class=p>/</span><span class=n>ether</span> <span class=mf>02</span><span class=err>:</span><span class=mf>42</span><span class=err>:</span><span class=n>e1</span><span class=err>:</span><span class=mf>16</span><span class=err>:</span><span class=mf>68</span><span class=err>:</span><span class=n>de</span> <span class=n>brd</span> <span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span>
</span></span><span class=line><span class=cl>    <span class=n>inet</span> <span class=mf>172.17</span><span class=p>.</span><span class=py>0</span><span class=p>.</span><span class=mf>1</span><span class=p>/</span><span class=mf>16</span> <span class=n>brd</span> <span class=mf>172.17</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=py>255</span> <span class=n>scope</span> <span class=n>global</span> <span class=n>docker0</span>
</span></span><span class=line><span class=cl>       <span class=n>valid_lft</span> <span class=n>forever</span> <span class=n>preferred_lft</span> <span class=n>forever</span>
</span></span><span class=line><span class=cl><span class=mf>6</span><span class=err>:</span> <span class=n>flannel0</span><span class=err>:</span> <span class=p>&lt;</span><span class=n>POINTOPOINT</span><span class=p>,</span><span class=n>MULTICAST</span><span class=p>,</span><span class=n>NOARP</span><span class=p>,</span><span class=n>UP</span><span class=p>,</span><span class=n>LOWER_UP</span><span class=p>&gt;</span> <span class=n>mtu</span> <span class=mf>1472</span> <span class=n>qdisc</span> <span class=n>pfifo_fast</span> <span class=n>state</span> <span class=n>UNKNOWN</span> <span class=nb>group </span><span class=k>default</span> <span class=n>qlen</span> <span class=mf>500</span>
</span></span><span class=line><span class=cl>    <span class=n>link</span><span class=p>/</span><span class=n>none</span>
</span></span><span class=line><span class=cl>    <span class=n>inet</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>55</span><span class=p>.</span><span class=mf>0</span><span class=p>/</span><span class=mf>16</span> <span class=n>scope</span> <span class=n>global</span> <span class=n>flannel0</span>
</span></span><span class=line><span class=cl>       <span class=n>valid_lft</span> <span class=n>forever</span> <span class=n>preferred_lft</span> <span class=n>forever</span>
</span></span><span class=line><span class=cl>    <span class=n>inet6</span> <span class=n>fe80</span><span class=p>::</span><span class=n>f895</span><span class=err>:</span><span class=n>9b5a</span><span class=err>:</span><span class=n>92b1</span><span class=err>:</span><span class=n>78aa</span><span class=p>/</span><span class=mf>64</span> <span class=n>scope</span> <span class=n>link</span> <span class=n>flags</span> <span class=mf>800</span>
</span></span><span class=line><span class=cl>       <span class=n>valid_lft</span> <span class=n>forever</span> <span class=n>preferred_lft</span> <span class=n>forever</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=57-docker-网络配置 class=headerLink><a href=#57-docker-%e7%bd%91%e7%bb%9c%e9%85%8d%e7%bd%ae class=header-mark></a>5.7 Docker 网络配置</h2><blockquote><p>&ndash;bip=172.21.31.1/24 &ndash;ip-masq=true &ndash;mtu=1472 放置于启动程序后</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># vim /usr/lib/systemd/system/docker.service</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># cat /usr/lib/systemd/system/docker.service</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=no>Unit</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Description</span><span class=p>=</span><span class=n>Docker</span> <span class=n>Application</span> <span class=n>Container</span> <span class=n>Engine</span>
</span></span><span class=line><span class=cl><span class=n>Documentation</span><span class=p>=</span><span class=n>https</span><span class=err>:</span><span class=p>//</span><span class=n>docs</span><span class=p>.</span><span class=py>docker</span><span class=p>.</span><span class=py>com</span>
</span></span><span class=line><span class=cl><span class=n>After</span><span class=p>=</span><span class=nb>network-online</span><span class=p>.</span><span class=py>target</span> <span class=n>firewalld</span><span class=p>.</span><span class=py>service</span> <span class=n>containerd</span><span class=p>.</span><span class=py>service</span>
</span></span><span class=line><span class=cl><span class=n>Wants</span><span class=p>=</span><span class=nb>network-online</span><span class=p>.</span><span class=py>target</span>
</span></span><span class=line><span class=cl><span class=n>Requires</span><span class=p>=</span><span class=n>docker</span><span class=p>.</span><span class=py>socket</span> <span class=n>containerd</span><span class=p>.</span><span class=py>service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=no>Service</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Type</span><span class=p>=</span><span class=n>notify</span>
</span></span><span class=line><span class=cl><span class=c># the default is not to use systemd for cgroups because the delegate issues still</span>
</span></span><span class=line><span class=cl><span class=c># exists and systemd currently does not support the cgroup feature set required</span>
</span></span><span class=line><span class=cl><span class=c># for containers run by docker</span>
</span></span><span class=line><span class=cl><span class=n>ExecStart</span><span class=p>=/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>dockerd</span> <span class=n>-H</span> <span class=n>fd</span><span class=err>:</span><span class=p>//</span> <span class=p>-</span><span class=n>-containerd</span><span class=p>=/</span><span class=n>run</span><span class=p>/</span><span class=n>containerd</span><span class=p>/</span><span class=n>containerd</span><span class=p>.</span><span class=py>sock</span> <span class=p>-</span><span class=n>-bip</span><span class=p>=</span><span class=mf>172.21</span><span class=p>.</span><span class=py>31</span><span class=p>.</span><span class=mf>1</span><span class=p>/</span><span class=mf>24</span> <span class=p>-</span><span class=n>-ip-masq</span><span class=p>=</span><span class=n>true</span> <span class=p>-</span><span class=n>-mtu</span><span class=p>=</span><span class=mf>1472</span>
</span></span><span class=line><span class=cl><span class=n>ExecReload</span><span class=p>=/</span><span class=n>bin</span><span class=p>/</span><span class=nb>kill </span><span class=n>-s</span> <span class=n>HUP</span> <span class=nv>$MAINPID</span>
</span></span><span class=line><span class=cl><span class=n>TimeoutSec</span><span class=p>=</span><span class=mf>0</span>
</span></span><span class=line><span class=cl><span class=n>RestartSec</span><span class=p>=</span><span class=mf>2</span>
</span></span><span class=line><span class=cl><span class=n>Restart</span><span class=p>=</span><span class=n>always</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Note that StartLimit* options were moved from &#34;Service&#34; to &#34;Unit&#34; in systemd 229.</span>
</span></span><span class=line><span class=cl><span class=c># Both the old, and new location are accepted by systemd 229 and up, so using the old location</span>
</span></span><span class=line><span class=cl><span class=c># to make them work for either version of systemd.</span>
</span></span><span class=line><span class=cl><span class=n>StartLimitBurst</span><span class=p>=</span><span class=mf>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.</span>
</span></span><span class=line><span class=cl><span class=c># Both the old, and new name are accepted by systemd 230 and up, so using the old name to make</span>
</span></span><span class=line><span class=cl><span class=c># this option work for either version of systemd.</span>
</span></span><span class=line><span class=cl><span class=n>StartLimitInterval</span><span class=p>=</span><span class=n>60s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Having non-zero Limit*s causes performance problems due to accounting overhead</span>
</span></span><span class=line><span class=cl><span class=c># in the kernel. We recommend using cgroups to do container-local accounting.</span>
</span></span><span class=line><span class=cl><span class=n>LimitNOFILE</span><span class=p>=</span><span class=n>infinity</span>
</span></span><span class=line><span class=cl><span class=n>LimitNPROC</span><span class=p>=</span><span class=n>infinity</span>
</span></span><span class=line><span class=cl><span class=n>LimitCORE</span><span class=p>=</span><span class=n>infinity</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Comment TasksMax if your systemd version does not support it.</span>
</span></span><span class=line><span class=cl><span class=c># Only systemd 226 and above support this option.</span>
</span></span><span class=line><span class=cl><span class=n>TasksMax</span><span class=p>=</span><span class=n>infinity</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># set delegate yes so that systemd does not reset the cgroups of docker containers</span>
</span></span><span class=line><span class=cl><span class=n>Delegate</span><span class=p>=</span><span class=n>yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># kill only the docker process, not all processes in the cgroup</span>
</span></span><span class=line><span class=cl><span class=n>KillMode</span><span class=p>=</span><span class=k>process</span>
</span></span><span class=line><span class=cl><span class=n>OOMScoreAdjust</span><span class=p>=</span><span class=mf>-500</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=no>Install</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>WantedBy</span><span class=p>=</span><span class=nb>multi-user</span><span class=p>.</span><span class=py>target</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># vim /usr/lib/systemd/system/docker.service</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># cat /usr/lib/systemd/system/docker.service</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=no>Unit</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Description</span><span class=p>=</span><span class=n>Docker</span> <span class=n>Application</span> <span class=n>Container</span> <span class=n>Engine</span>
</span></span><span class=line><span class=cl><span class=n>Documentation</span><span class=p>=</span><span class=n>https</span><span class=err>:</span><span class=p>//</span><span class=n>docs</span><span class=p>.</span><span class=py>docker</span><span class=p>.</span><span class=py>com</span>
</span></span><span class=line><span class=cl><span class=n>After</span><span class=p>=</span><span class=nb>network-online</span><span class=p>.</span><span class=py>target</span> <span class=n>firewalld</span><span class=p>.</span><span class=py>service</span> <span class=n>containerd</span><span class=p>.</span><span class=py>service</span>
</span></span><span class=line><span class=cl><span class=n>Wants</span><span class=p>=</span><span class=nb>network-online</span><span class=p>.</span><span class=py>target</span>
</span></span><span class=line><span class=cl><span class=n>Requires</span><span class=p>=</span><span class=n>docker</span><span class=p>.</span><span class=py>socket</span> <span class=n>containerd</span><span class=p>.</span><span class=py>service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=no>Service</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Type</span><span class=p>=</span><span class=n>notify</span>
</span></span><span class=line><span class=cl><span class=c># the default is not to use systemd for cgroups because the delegate issues still</span>
</span></span><span class=line><span class=cl><span class=c># exists and systemd currently does not support the cgroup feature set required</span>
</span></span><span class=line><span class=cl><span class=c># for containers run by docker</span>
</span></span><span class=line><span class=cl><span class=n>ExecStart</span><span class=p>=/</span><span class=n>usr</span><span class=p>/</span><span class=n>bin</span><span class=p>/</span><span class=n>dockerd</span> <span class=n>-H</span> <span class=n>fd</span><span class=err>:</span><span class=p>//</span> <span class=p>-</span><span class=n>-containerd</span><span class=p>=/</span><span class=n>run</span><span class=p>/</span><span class=n>containerd</span><span class=p>/</span><span class=n>containerd</span><span class=p>.</span><span class=py>sock</span> <span class=p>-</span><span class=n>-bip</span><span class=p>=</span><span class=mf>172.21</span><span class=p>.</span><span class=py>55</span><span class=p>.</span><span class=mf>1</span><span class=p>/</span><span class=mf>24</span> <span class=p>-</span><span class=n>-ip-masq</span><span class=p>=</span><span class=n>true</span> <span class=p>-</span><span class=n>-mtu</span><span class=p>=</span><span class=mf>1472</span>
</span></span><span class=line><span class=cl><span class=n>ExecReload</span><span class=p>=/</span><span class=n>bin</span><span class=p>/</span><span class=nb>kill </span><span class=n>-s</span> <span class=n>HUP</span> <span class=nv>$MAINPID</span>
</span></span><span class=line><span class=cl><span class=n>TimeoutSec</span><span class=p>=</span><span class=mf>0</span>
</span></span><span class=line><span class=cl><span class=n>RestartSec</span><span class=p>=</span><span class=mf>2</span>
</span></span><span class=line><span class=cl><span class=n>Restart</span><span class=p>=</span><span class=n>always</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Note that StartLimit* options were moved from &#34;Service&#34; to &#34;Unit&#34; in systemd 229.</span>
</span></span><span class=line><span class=cl><span class=c># Both the old, and new location are accepted by systemd 229 and up, so using the old location</span>
</span></span><span class=line><span class=cl><span class=c># to make them work for either version of systemd.</span>
</span></span><span class=line><span class=cl><span class=n>StartLimitBurst</span><span class=p>=</span><span class=mf>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.</span>
</span></span><span class=line><span class=cl><span class=c># Both the old, and new name are accepted by systemd 230 and up, so using the old name to make</span>
</span></span><span class=line><span class=cl><span class=c># this option work for either version of systemd.</span>
</span></span><span class=line><span class=cl><span class=n>StartLimitInterval</span><span class=p>=</span><span class=n>60s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Having non-zero Limit*s causes performance problems due to accounting overhead</span>
</span></span><span class=line><span class=cl><span class=c># in the kernel. We recommend using cgroups to do container-local accounting.</span>
</span></span><span class=line><span class=cl><span class=n>LimitNOFILE</span><span class=p>=</span><span class=n>infinity</span>
</span></span><span class=line><span class=cl><span class=n>LimitNPROC</span><span class=p>=</span><span class=n>infinity</span>
</span></span><span class=line><span class=cl><span class=n>LimitCORE</span><span class=p>=</span><span class=n>infinity</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Comment TasksMax if your systemd version does not support it.</span>
</span></span><span class=line><span class=cl><span class=c># Only systemd 226 and above support this option.</span>
</span></span><span class=line><span class=cl><span class=n>TasksMax</span><span class=p>=</span><span class=n>infinity</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># set delegate yes so that systemd does not reset the cgroups of docker containers</span>
</span></span><span class=line><span class=cl><span class=n>Delegate</span><span class=p>=</span><span class=n>yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># kill only the docker process, not all processes in the cgroup</span>
</span></span><span class=line><span class=cl><span class=n>KillMode</span><span class=p>=</span><span class=k>process</span>
</span></span><span class=line><span class=cl><span class=n>OOMScoreAdjust</span><span class=p>=</span><span class=mf>-500</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=no>Install</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>WantedBy</span><span class=p>=</span><span class=nb>multi-user</span><span class=p>.</span><span class=py>target</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># systemctl daemon-reload</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># systemctl restart docker</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># ip a s</span>
</span></span><span class=line><span class=cl><span class=p>......</span>
</span></span><span class=line><span class=cl><span class=mf>5</span><span class=err>:</span> <span class=n>docker0</span><span class=err>:</span> <span class=p>&lt;</span><span class=nb>NO-CARRIER</span><span class=p>,</span><span class=n>BROADCAST</span><span class=p>,</span><span class=n>MULTICAST</span><span class=p>,</span><span class=n>UP</span><span class=p>&gt;</span> <span class=n>mtu</span> <span class=mf>1500</span> <span class=n>qdisc</span> <span class=n>noqueue</span> <span class=n>state</span> <span class=n>DOWN</span> <span class=nb>group </span><span class=k>default</span>
</span></span><span class=line><span class=cl>    <span class=n>link</span><span class=p>/</span><span class=n>ether</span> <span class=mf>02</span><span class=err>:</span><span class=mf>42</span><span class=err>:</span><span class=mf>63</span><span class=err>:</span><span class=n>d1</span><span class=err>:</span><span class=n>9e</span><span class=err>:</span><span class=n>0b</span> <span class=n>brd</span> <span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span>
</span></span><span class=line><span class=cl>    <span class=n>inet</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>31</span><span class=p>.</span><span class=mf>1</span><span class=p>/</span><span class=mf>24</span> <span class=n>brd</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>31</span><span class=p>.</span><span class=py>255</span> <span class=n>scope</span> <span class=n>global</span> <span class=n>docker0</span>
</span></span><span class=line><span class=cl>       <span class=n>valid_lft</span> <span class=n>forever</span> <span class=n>preferred_lft</span> <span class=n>forever</span>
</span></span><span class=line><span class=cl><span class=mf>6</span><span class=err>:</span> <span class=n>flannel0</span><span class=err>:</span> <span class=p>&lt;</span><span class=n>POINTOPOINT</span><span class=p>,</span><span class=n>MULTICAST</span><span class=p>,</span><span class=n>NOARP</span><span class=p>,</span><span class=n>UP</span><span class=p>,</span><span class=n>LOWER_UP</span><span class=p>&gt;</span> <span class=n>mtu</span> <span class=mf>1472</span> <span class=n>qdisc</span> <span class=n>pfifo_fast</span> <span class=n>state</span> <span class=n>UNKNOWN</span> <span class=nb>group </span><span class=k>default</span> <span class=n>qlen</span> <span class=mf>500</span>
</span></span><span class=line><span class=cl>    <span class=n>link</span><span class=p>/</span><span class=n>none</span>
</span></span><span class=line><span class=cl>    <span class=n>inet</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>31</span><span class=p>.</span><span class=mf>0</span><span class=p>/</span><span class=mf>16</span> <span class=n>scope</span> <span class=n>global</span> <span class=n>flannel0</span>
</span></span><span class=line><span class=cl>       <span class=n>valid_lft</span> <span class=n>forever</span> <span class=n>preferred_lft</span> <span class=n>forever</span>
</span></span><span class=line><span class=cl>    <span class=n>inet6</span> <span class=n>fe80</span><span class=p>::</span><span class=n>edfa</span><span class=err>:</span><span class=n>d8b0</span><span class=err>:</span><span class=mf>3351</span><span class=err>:</span><span class=mf>4126</span><span class=p>/</span><span class=mf>64</span> <span class=n>scope</span> <span class=n>link</span> <span class=n>flags</span> <span class=mf>800</span>
</span></span><span class=line><span class=cl>       <span class=n>valid_lft</span> <span class=n>forever</span> <span class=n>preferred_lft</span> <span class=n>forever</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># systemctl daemon-reload</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># systemctl restart docker</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># ip a s</span>
</span></span><span class=line><span class=cl><span class=p>......</span>
</span></span><span class=line><span class=cl><span class=mf>5</span><span class=err>:</span> <span class=n>docker0</span><span class=err>:</span> <span class=p>&lt;</span><span class=nb>NO-CARRIER</span><span class=p>,</span><span class=n>BROADCAST</span><span class=p>,</span><span class=n>MULTICAST</span><span class=p>,</span><span class=n>UP</span><span class=p>&gt;</span> <span class=n>mtu</span> <span class=mf>1500</span> <span class=n>qdisc</span> <span class=n>noqueue</span> <span class=n>state</span> <span class=n>DOWN</span> <span class=nb>group </span><span class=k>default</span>
</span></span><span class=line><span class=cl>    <span class=n>link</span><span class=p>/</span><span class=n>ether</span> <span class=mf>02</span><span class=err>:</span><span class=mf>42</span><span class=err>:</span><span class=n>e1</span><span class=err>:</span><span class=mf>16</span><span class=err>:</span><span class=mf>68</span><span class=err>:</span><span class=n>de</span> <span class=n>brd</span> <span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span><span class=err>:</span><span class=n>ff</span>
</span></span><span class=line><span class=cl>    <span class=n>inet</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>55</span><span class=p>.</span><span class=mf>1</span><span class=p>/</span><span class=mf>24</span> <span class=n>brd</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>55</span><span class=p>.</span><span class=py>255</span> <span class=n>scope</span> <span class=n>global</span> <span class=n>docker0</span>
</span></span><span class=line><span class=cl>       <span class=n>valid_lft</span> <span class=n>forever</span> <span class=n>preferred_lft</span> <span class=n>forever</span>
</span></span><span class=line><span class=cl><span class=mf>6</span><span class=err>:</span> <span class=n>flannel0</span><span class=err>:</span> <span class=p>&lt;</span><span class=n>POINTOPOINT</span><span class=p>,</span><span class=n>MULTICAST</span><span class=p>,</span><span class=n>NOARP</span><span class=p>,</span><span class=n>UP</span><span class=p>,</span><span class=n>LOWER_UP</span><span class=p>&gt;</span> <span class=n>mtu</span> <span class=mf>1472</span> <span class=n>qdisc</span> <span class=n>pfifo_fast</span> <span class=n>state</span> <span class=n>UNKNOWN</span> <span class=nb>group </span><span class=k>default</span> <span class=n>qlen</span> <span class=mf>500</span>
</span></span><span class=line><span class=cl>    <span class=n>link</span><span class=p>/</span><span class=n>none</span>
</span></span><span class=line><span class=cl>    <span class=n>inet</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>55</span><span class=p>.</span><span class=mf>0</span><span class=p>/</span><span class=mf>16</span> <span class=n>scope</span> <span class=n>global</span> <span class=n>flannel0</span>
</span></span><span class=line><span class=cl>       <span class=n>valid_lft</span> <span class=n>forever</span> <span class=n>preferred_lft</span> <span class=n>forever</span>
</span></span><span class=line><span class=cl>    <span class=n>inet6</span> <span class=n>fe80</span><span class=p>::</span><span class=n>f895</span><span class=err>:</span><span class=n>9b5a</span><span class=err>:</span><span class=n>92b1</span><span class=err>:</span><span class=n>78aa</span><span class=p>/</span><span class=mf>64</span> <span class=n>scope</span> <span class=n>link</span> <span class=n>flags</span> <span class=mf>800</span>
</span></span><span class=line><span class=cl>       <span class=n>valid_lft</span> <span class=n>forever</span> <span class=n>preferred_lft</span> <span class=n>forever</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=58-跨-docker-host-容器间通信验证 class=headerLink><a href=#58-%e8%b7%a8-docker-host-%e5%ae%b9%e5%99%a8%e9%97%b4%e9%80%9a%e4%bf%a1%e9%aa%8c%e8%af%81 class=header-mark></a>5.8 跨 Docker Host 容器间通信验证</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node1</span> <span class=p>~]</span><span class=c># docker run -it --rm busybox:latest</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>/</span> <span class=c># ifconfig</span>
</span></span><span class=line><span class=cl><span class=n>eth0</span>      <span class=n>Link</span> <span class=n>encap</span><span class=err>:</span><span class=n>Ethernet</span>  <span class=n>HWaddr</span> <span class=mf>02</span><span class=err>:</span><span class=mf>42</span><span class=err>:</span><span class=n>AC</span><span class=err>:</span><span class=mf>15</span><span class=err>:</span><span class=mf>1F</span><span class=err>:</span><span class=mf>02</span>
</span></span><span class=line><span class=cl>          <span class=n>inet</span> <span class=n>addr</span><span class=err>:</span><span class=mf>172.21</span><span class=p>.</span><span class=py>31</span><span class=p>.</span><span class=py>2</span>  <span class=n>Bcast</span><span class=err>:</span><span class=mf>172.21</span><span class=p>.</span><span class=py>31</span><span class=p>.</span><span class=py>255</span>  <span class=n>Mask</span><span class=err>:</span><span class=mf>255.255</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=py>0</span>
</span></span><span class=line><span class=cl>          <span class=n>UP</span> <span class=n>BROADCAST</span> <span class=n>RUNNING</span> <span class=n>MULTICAST</span>  <span class=n>MTU</span><span class=err>:</span><span class=mf>1472</span>  <span class=n>Metric</span><span class=err>:</span><span class=mf>1</span>
</span></span><span class=line><span class=cl>          <span class=n>RX</span> <span class=n>packets</span><span class=err>:</span><span class=mf>21</span> <span class=n>errors</span><span class=err>:</span><span class=mf>0</span> <span class=n>dropped</span><span class=err>:</span><span class=mf>0</span> <span class=n>overruns</span><span class=err>:</span><span class=mf>0</span> <span class=n>frame</span><span class=err>:</span><span class=mf>0</span>
</span></span><span class=line><span class=cl>          <span class=n>TX</span> <span class=n>packets</span><span class=err>:</span><span class=mf>0</span> <span class=n>errors</span><span class=err>:</span><span class=mf>0</span> <span class=n>dropped</span><span class=err>:</span><span class=mf>0</span> <span class=n>overruns</span><span class=err>:</span><span class=mf>0</span> <span class=n>carrier</span><span class=err>:</span><span class=mf>0</span>
</span></span><span class=line><span class=cl>          <span class=n>collisions</span><span class=err>:</span><span class=mf>0</span> <span class=n>txqueuelen</span><span class=err>:</span><span class=mf>0</span>
</span></span><span class=line><span class=cl>          <span class=n>RX</span> <span class=n>bytes</span><span class=err>:</span><span class=mf>2424</span> <span class=p>(</span><span class=mf>2.3</span> <span class=n>KiB</span><span class=p>)</span>  <span class=n>TX</span> <span class=n>bytes</span><span class=err>:</span><span class=mf>0</span> <span class=p>(</span><span class=mf>0.0</span> <span class=n>B</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lo</span>        <span class=n>Link</span> <span class=n>encap</span><span class=err>:</span><span class=n>Local</span> <span class=n>Loopback</span>
</span></span><span class=line><span class=cl>          <span class=n>inet</span> <span class=n>addr</span><span class=err>:</span><span class=mf>127.0</span><span class=p>.</span><span class=py>0</span><span class=p>.</span><span class=py>1</span>  <span class=n>Mask</span><span class=err>:</span><span class=mf>255.0</span><span class=p>.</span><span class=py>0</span><span class=p>.</span><span class=py>0</span>
</span></span><span class=line><span class=cl>          <span class=n>UP</span> <span class=n>LOOPBACK</span> <span class=n>RUNNING</span>  <span class=n>MTU</span><span class=err>:</span><span class=mf>65536</span>  <span class=n>Metric</span><span class=err>:</span><span class=mf>1</span>
</span></span><span class=line><span class=cl>          <span class=n>RX</span> <span class=n>packets</span><span class=err>:</span><span class=mf>0</span> <span class=n>errors</span><span class=err>:</span><span class=mf>0</span> <span class=n>dropped</span><span class=err>:</span><span class=mf>0</span> <span class=n>overruns</span><span class=err>:</span><span class=mf>0</span> <span class=n>frame</span><span class=err>:</span><span class=mf>0</span>
</span></span><span class=line><span class=cl>          <span class=n>TX</span> <span class=n>packets</span><span class=err>:</span><span class=mf>0</span> <span class=n>errors</span><span class=err>:</span><span class=mf>0</span> <span class=n>dropped</span><span class=err>:</span><span class=mf>0</span> <span class=n>overruns</span><span class=err>:</span><span class=mf>0</span> <span class=n>carrier</span><span class=err>:</span><span class=mf>0</span>
</span></span><span class=line><span class=cl>          <span class=n>collisions</span><span class=err>:</span><span class=mf>0</span> <span class=n>txqueuelen</span><span class=err>:</span><span class=mf>1000</span>
</span></span><span class=line><span class=cl>          <span class=n>RX</span> <span class=n>bytes</span><span class=err>:</span><span class=mf>0</span> <span class=p>(</span><span class=mf>0.0</span> <span class=n>B</span><span class=p>)</span>  <span class=n>TX</span> <span class=n>bytes</span><span class=err>:</span><span class=mf>0</span> <span class=p>(</span><span class=mf>0.0</span> <span class=n>B</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>/</span> <span class=c># ping 172.21.55.2</span>
</span></span><span class=line><span class=cl><span class=n>PING</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>55</span><span class=p>.</span><span class=py>2</span> <span class=p>(</span><span class=mf>172.21</span><span class=p>.</span><span class=py>55</span><span class=p>.</span><span class=mf>2</span><span class=p>)</span><span class=err>:</span> <span class=mf>56</span> <span class=n>data</span> <span class=n>bytes</span>
</span></span><span class=line><span class=cl><span class=mf>64</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>55</span><span class=p>.</span><span class=mf>2</span><span class=err>:</span> <span class=n>seq</span><span class=p>=</span><span class=mf>0</span> <span class=n>ttl</span><span class=p>=</span><span class=mf>60</span> <span class=n>time</span><span class=p>=</span><span class=mf>2.141</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mf>64</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>55</span><span class=p>.</span><span class=mf>2</span><span class=err>:</span> <span class=n>seq</span><span class=p>=</span><span class=mf>1</span> <span class=n>ttl</span><span class=p>=</span><span class=mf>60</span> <span class=n>time</span><span class=p>=</span><span class=mf>1.219</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mf>64</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>55</span><span class=p>.</span><span class=mf>2</span><span class=err>:</span> <span class=n>seq</span><span class=p>=</span><span class=mf>2</span> <span class=n>ttl</span><span class=p>=</span><span class=mf>60</span> <span class=n>time</span><span class=p>=</span><span class=mf>0.730</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=p>^</span><span class=n>C</span>
</span></span><span class=line><span class=cl><span class=p>---</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>55</span><span class=p>.</span><span class=py>2</span> <span class=n>ping</span> <span class=n>statistics</span> <span class=p>---</span>
</span></span><span class=line><span class=cl><span class=mf>3</span> <span class=n>packets</span> <span class=n>transmitted</span><span class=p>,</span> <span class=mf>3</span> <span class=n>packets</span> <span class=n>received</span><span class=p>,</span> <span class=mf>0</span><span class=p>%</span> <span class=n>packet</span> <span class=n>loss</span>
</span></span><span class=line><span class=cl><span class=nb>round-trip</span> <span class=n>min</span><span class=p>/</span><span class=n>avg</span><span class=p>/</span><span class=n>max</span> <span class=p>=</span> <span class=mf>0.730</span><span class=p>/</span><span class=mf>1.363</span><span class=p>/</span><span class=mf>2.141</span> <span class=n>ms</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=nv>@node2</span> <span class=p>~]</span><span class=c># docker run -it --rm busybox:latest</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>/</span> <span class=c># ifconfig</span>
</span></span><span class=line><span class=cl><span class=n>eth0</span>      <span class=n>Link</span> <span class=n>encap</span><span class=err>:</span><span class=n>Ethernet</span>  <span class=n>HWaddr</span> <span class=mf>02</span><span class=err>:</span><span class=mf>42</span><span class=err>:</span><span class=n>AC</span><span class=err>:</span><span class=mf>15</span><span class=err>:</span><span class=mf>37</span><span class=err>:</span><span class=mf>02</span>
</span></span><span class=line><span class=cl>          <span class=n>inet</span> <span class=n>addr</span><span class=err>:</span><span class=mf>172.21</span><span class=p>.</span><span class=py>55</span><span class=p>.</span><span class=py>2</span>  <span class=n>Bcast</span><span class=err>:</span><span class=mf>172.21</span><span class=p>.</span><span class=py>55</span><span class=p>.</span><span class=py>255</span>  <span class=n>Mask</span><span class=err>:</span><span class=mf>255.255</span><span class=p>.</span><span class=py>255</span><span class=p>.</span><span class=py>0</span>
</span></span><span class=line><span class=cl>          <span class=n>UP</span> <span class=n>BROADCAST</span> <span class=n>RUNNING</span> <span class=n>MULTICAST</span>  <span class=n>MTU</span><span class=err>:</span><span class=mf>1472</span>  <span class=n>Metric</span><span class=err>:</span><span class=mf>1</span>
</span></span><span class=line><span class=cl>          <span class=n>RX</span> <span class=n>packets</span><span class=err>:</span><span class=mf>19</span> <span class=n>errors</span><span class=err>:</span><span class=mf>0</span> <span class=n>dropped</span><span class=err>:</span><span class=mf>0</span> <span class=n>overruns</span><span class=err>:</span><span class=mf>0</span> <span class=n>frame</span><span class=err>:</span><span class=mf>0</span>
</span></span><span class=line><span class=cl>          <span class=n>TX</span> <span class=n>packets</span><span class=err>:</span><span class=mf>0</span> <span class=n>errors</span><span class=err>:</span><span class=mf>0</span> <span class=n>dropped</span><span class=err>:</span><span class=mf>0</span> <span class=n>overruns</span><span class=err>:</span><span class=mf>0</span> <span class=n>carrier</span><span class=err>:</span><span class=mf>0</span>
</span></span><span class=line><span class=cl>          <span class=n>collisions</span><span class=err>:</span><span class=mf>0</span> <span class=n>txqueuelen</span><span class=err>:</span><span class=mf>0</span>
</span></span><span class=line><span class=cl>          <span class=n>RX</span> <span class=n>bytes</span><span class=err>:</span><span class=mf>2246</span> <span class=p>(</span><span class=mf>2.1</span> <span class=n>KiB</span><span class=p>)</span>  <span class=n>TX</span> <span class=n>bytes</span><span class=err>:</span><span class=mf>0</span> <span class=p>(</span><span class=mf>0.0</span> <span class=n>B</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lo</span>        <span class=n>Link</span> <span class=n>encap</span><span class=err>:</span><span class=n>Local</span> <span class=n>Loopback</span>
</span></span><span class=line><span class=cl>          <span class=n>inet</span> <span class=n>addr</span><span class=err>:</span><span class=mf>127.0</span><span class=p>.</span><span class=py>0</span><span class=p>.</span><span class=py>1</span>  <span class=n>Mask</span><span class=err>:</span><span class=mf>255.0</span><span class=p>.</span><span class=py>0</span><span class=p>.</span><span class=py>0</span>
</span></span><span class=line><span class=cl>          <span class=n>UP</span> <span class=n>LOOPBACK</span> <span class=n>RUNNING</span>  <span class=n>MTU</span><span class=err>:</span><span class=mf>65536</span>  <span class=n>Metric</span><span class=err>:</span><span class=mf>1</span>
</span></span><span class=line><span class=cl>          <span class=n>RX</span> <span class=n>packets</span><span class=err>:</span><span class=mf>0</span> <span class=n>errors</span><span class=err>:</span><span class=mf>0</span> <span class=n>dropped</span><span class=err>:</span><span class=mf>0</span> <span class=n>overruns</span><span class=err>:</span><span class=mf>0</span> <span class=n>frame</span><span class=err>:</span><span class=mf>0</span>
</span></span><span class=line><span class=cl>          <span class=n>TX</span> <span class=n>packets</span><span class=err>:</span><span class=mf>0</span> <span class=n>errors</span><span class=err>:</span><span class=mf>0</span> <span class=n>dropped</span><span class=err>:</span><span class=mf>0</span> <span class=n>overruns</span><span class=err>:</span><span class=mf>0</span> <span class=n>carrier</span><span class=err>:</span><span class=mf>0</span>
</span></span><span class=line><span class=cl>          <span class=n>collisions</span><span class=err>:</span><span class=mf>0</span> <span class=n>txqueuelen</span><span class=err>:</span><span class=mf>1000</span>
</span></span><span class=line><span class=cl>          <span class=n>RX</span> <span class=n>bytes</span><span class=err>:</span><span class=mf>0</span> <span class=p>(</span><span class=mf>0.0</span> <span class=n>B</span><span class=p>)</span>  <span class=n>TX</span> <span class=n>bytes</span><span class=err>:</span><span class=mf>0</span> <span class=p>(</span><span class=mf>0.0</span> <span class=n>B</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>/</span> <span class=c># ping 172.21.31.2</span>
</span></span><span class=line><span class=cl><span class=n>PING</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>31</span><span class=p>.</span><span class=py>2</span> <span class=p>(</span><span class=mf>172.21</span><span class=p>.</span><span class=py>31</span><span class=p>.</span><span class=mf>2</span><span class=p>)</span><span class=err>:</span> <span class=mf>56</span> <span class=n>data</span> <span class=n>bytes</span>
</span></span><span class=line><span class=cl><span class=mf>64</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>31</span><span class=p>.</span><span class=mf>2</span><span class=err>:</span> <span class=n>seq</span><span class=p>=</span><span class=mf>0</span> <span class=n>ttl</span><span class=p>=</span><span class=mf>60</span> <span class=n>time</span><span class=p>=</span><span class=mf>1.286</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mf>64</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>31</span><span class=p>.</span><span class=mf>2</span><span class=err>:</span> <span class=n>seq</span><span class=p>=</span><span class=mf>1</span> <span class=n>ttl</span><span class=p>=</span><span class=mf>60</span> <span class=n>time</span><span class=p>=</span><span class=mf>0.552</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=p>^</span><span class=n>C</span>
</span></span><span class=line><span class=cl><span class=p>---</span> <span class=mf>172.21</span><span class=p>.</span><span class=py>31</span><span class=p>.</span><span class=py>2</span> <span class=n>ping</span> <span class=n>statistics</span> <span class=p>---</span>
</span></span><span class=line><span class=cl><span class=mf>2</span> <span class=n>packets</span> <span class=n>transmitted</span><span class=p>,</span> <span class=mf>2</span> <span class=n>packets</span> <span class=n>received</span><span class=p>,</span> <span class=mf>0</span><span class=p>%</span> <span class=n>packet</span> <span class=n>loss</span>
</span></span><span class=line><span class=cl><span class=nb>round-trip</span> <span class=n>min</span><span class=p>/</span><span class=n>avg</span><span class=p>/</span><span class=n>max</span> <span class=p>=</span> <span class=mf>0.552</span><span class=p>/</span><span class=mf>0.919</span><span class=p>/</span><span class=mf>1.286</span> <span class=n>ms</span>
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2023-11-24</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><button title="分享到 Twitter" data-sharer=twitter data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/point/flannel/ data-title=Flannel data-hashtags=point,Flannel><span class="fab fa-twitter fa-fw"></span></button><button title="分享到 Facebook" data-sharer=facebook data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/point/flannel/ data-hashtag=point><span class="fab fa-facebook-square fa-fw"></span></button><button title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/point/flannel/ data-title=Flannel data-web><span class="fab fa-whatsapp fa-fw"></span></button><button title="分享到 Line" data-sharer=line data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/point/flannel/ data-title=Flannel><span data-svg-src=/lib/simple-icons/icons/line.min.svg></span></button><button title="分享到 微博" data-sharer=weibo data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/point/flannel/ data-title=Flannel><span class="fab fa-weibo fa-fw"></span></button><button title="分享到 Myspace" data-sharer=myspace data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/point/flannel/ data-title=Flannel data-description><span data-svg-src=/lib/simple-icons/icons/myspace.min.svg></span></button><button title="分享到 Blogger" data-sharer=blogger data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/point/flannel/ data-title=Flannel data-description><span class="fab fa-blogger fa-fw"></span></button><button title="分享到 Evernote" data-sharer=evernote data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/point/flannel/ data-title=Flannel><span class="fab fa-evernote fa-fw"></span></button></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/point/>point</a>,&nbsp;<a href=/tags/flannel/>Flannel</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/%E6%97%A5%E8%AE%B0/2023-11-19/ class=prev rel=prev title=2023-11-19><i class="fas fa-angle-left fa-fw"></i>2023-11-19</a>
<a href=/posts/%E6%97%A5%E8%AE%B0/2023-11-25/ class=next rel=next title=2023-11-25>2023-11-25<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>1993 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://kentxxq.com target=_blank rel="noopener noreferrer">kentxxq</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a> | <a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=43010402000934"><img src=/备案图标.png style=display:inline-block>湘公网安备 43010402000934号</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a target=_blank href=https://beian.miit.gov.cn>湘ICP备2021002319号-1</a></span></div><div class=footer-line></div><div class=footer-line></div></div><script>"serviceWorker"in navigator&&(navigator.serviceWorker.register("/sw.min.js",{scope:"/"}).then(function(){}),navigator.serviceWorker.ready.then(function(){}))</script></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/katex/copy-tex.min.css><noscript><link rel=stylesheet href=/lib/katex/copy-tex.min.css></noscript><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:18},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:50,threshold:.3,type:"fuse",useExtendedSearch:!1},sharerjs:!0,twemoji:!0}</script><script type=text/javascript src=/lib/twemoji/twemoji.min.js defer></script><script type=text/javascript src=/js/twemoji.min.js defer></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/js/katex.min.js defer></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-NLLDC353PJ",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-NLLDC353PJ" async></script></div></body></html>