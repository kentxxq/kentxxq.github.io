<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>oracle-使用技巧 - 运维个人技术栈</title><meta name=Description content="因为以前的公司是用 [[笔记/point/oracle|oracle]],所以也记录了不少的命令. 记录一下后续使用."><meta property="og:title" content="oracle-使用技巧"><meta property="og:description" content="因为以前的公司是用 [[笔记/point/oracle|oracle]],所以也记录了不少的命令. 记录一下后续使用."><meta property="og:type" content="article"><meta property="og:url" content="https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/oracle-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-06T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-16T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="oracle-使用技巧"><meta name=twitter:description content="因为以前的公司是用 [[笔记/point/oracle|oracle]],所以也记录了不少的命令. 记录一下后续使用."><meta name=application-name content="kentxxq"><meta name=apple-mobile-web-app-title content="kentxxq"><meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/oracle-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/><link rel=prev href=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/point/redis/><link rel=next href=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/point/oracle/><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"oracle-使用技巧","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kentxxq.com\/posts\/%E7%AC%94%E8%AE%B0\/oracle-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7\/"},"genre":"posts","keywords":"blog, oracle","wordcount":1043,"url":"https:\/\/kentxxq.com\/posts\/%E7%AC%94%E8%AE%B0\/oracle-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7\/","datePublished":"2023-07-06T00:00:00+00:00","dateModified":"2023-08-16T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"kentxxq"},"description":"因为以前的公司是用 [[笔记/point/oracle|oracle]],所以也记录了不少的命令. 记录一下后续使用."}</script><script src=//instant.page/5.2.0 defer type=module integrity=sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z></script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else""==="light"||""==="dark"||""==="black"?(setTheme(""),saveTheme("")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=运维个人技术栈>运维个人技术栈</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Blog </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/about/>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=运维个人技术栈>运维个人技术栈</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>Blog</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#简介>简介</a></li><li><a href=#使用技巧>使用技巧</a><ul><li><a href=#字段操作>字段操作</a></li><li><a href=#收集统计信息>收集统计信息</a></li><li><a href=#触发器>触发器</a></li><li><a href=#索引>索引</a></li><li><a href=#重建所有索引>重建所有索引</a></li><li><a href=#日志切换时间>日志切换时间</a></li><li><a href=#删除操作>删除操作</a></li><li><a href=#sql-优化>sql 优化</a><ul><li><a href=#查看执行计划>查看执行计划</a></li><li><a href=#查看-session-执行的-sql>查看 session 执行的 sql</a></li><li><a href=#sql-tuning>sql-tuning</a></li></ul></li></ul></li><li><a href=#生成-awr>生成 AWR</a></li><li><a href=#常用图表>常用图表</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">oracle-使用技巧</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class="author fas fa-user-circle fa-fw"></span><a href=https://kentxxq.com title=Author target=_blank rel="noopener noreferrer author" class=author>kentxxq</a>
</span>&nbsp;<span class=post-category>收录于 </span>&nbsp;<span class=post-category>类别 <a href=/categories/blog/><i class="far fa-folder fa-fw"></i>blog</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2023-07-06>2023-07-06</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2023-08-16>2023-08-16</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 1043 字&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 3 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#简介>简介</a></li><li><a href=#使用技巧>使用技巧</a><ul><li><a href=#字段操作>字段操作</a></li><li><a href=#收集统计信息>收集统计信息</a></li><li><a href=#触发器>触发器</a></li><li><a href=#索引>索引</a></li><li><a href=#重建所有索引>重建所有索引</a></li><li><a href=#日志切换时间>日志切换时间</a></li><li><a href=#删除操作>删除操作</a></li><li><a href=#sql-优化>sql 优化</a><ul><li><a href=#查看执行计划>查看执行计划</a></li><li><a href=#查看-session-执行的-sql>查看 session 执行的 sql</a></li><li><a href=#sql-tuning>sql-tuning</a></li></ul></li></ul></li><li><a href=#生成-awr>生成 AWR</a></li><li><a href=#常用图表>常用图表</a></li></ul></nav></div></div><div class=content id=content><h2 id=简介 class=headerLink><a href=#%e7%ae%80%e4%bb%8b class=header-mark></a>简介</h2><p>因为以前的公司是用 <a href=/posts/%E7%AC%94%E8%AE%B0/point/oracle/>oracle</a>,所以也记录了不少的技巧. 记录一下后续使用.</p><h2 id=使用技巧 class=headerLink><a href=#%e4%bd%bf%e7%94%a8%e6%8a%80%e5%b7%a7 class=header-mark></a>使用技巧</h2><h3 id=字段操作 class=headerLink><a href=#%e5%ad%97%e6%ae%b5%e6%93%8d%e4%bd%9c class=header-mark></a>字段操作</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>字符串截取</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>substr</span><span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>family_no</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>)</span><span class=o>=</span><span class=s1>&#39;433127&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>日期转换</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>systimestamp</span><span class=w> </span><span class=err>时间戳</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>sysdate</span><span class=w> </span><span class=err>日期</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>to_date</span><span class=p>(</span><span class=s1>&#39;20170101&#39;</span><span class=p>,</span><span class=s1>&#39;yyyymmdd&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>to_char</span><span class=p>(</span><span class=n>sysdate</span><span class=p>,</span><span class=s1>&#39;YYYY-MM-DD HH24:MI:SS&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>值判断</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CASE</span><span class=w> </span><span class=k>WHEN</span><span class=w> </span><span class=n>A</span><span class=p>.</span><span class=n>STR7</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=w> </span><span class=k>ELSE</span><span class=w> </span><span class=s1>&#39;0001&#39;</span><span class=w> </span><span class=k>END</span><span class=w>  </span><span class=k>AS</span><span class=w> </span><span class=n>haha</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>类似</span><span class=k>case</span><span class=w> </span><span class=k>when</span><span class=p>,</span><span class=n>v1</span><span class=err>就取</span><span class=n>r1</span><span class=p>,</span><span class=n>v2</span><span class=err>就取</span><span class=n>r2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>DECODE</span><span class=p>(</span><span class=k>column_name</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;value1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;result1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;value2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;result2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;default_result&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>长度判断</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=k>length</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>id_card</span><span class=p>)</span><span class=o>&gt;=</span><span class=mi>14</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>在列表中</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>D</span><span class=p>.</span><span class=k>IDENTITY</span><span class=w> </span><span class=k>IN</span><span class=p>(</span><span class=s1>&#39;0001&#39;</span><span class=p>,</span><span class=s1>&#39;17&#39;</span><span class=p>,</span><span class=s1>&#39;20&#39;</span><span class=p>,</span><span class=s1>&#39;19&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>值为</span><span class=n>null</span><span class=err>就默认</span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>NVL</span><span class=p>(</span><span class=n>A</span><span class=p>.</span><span class=n>CIVIL_MONEY</span><span class=p>,</span><span class=mi>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>转数字</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>to_number</span><span class=p>(</span><span class=n>NVL</span><span class=p>(</span><span class=n>A</span><span class=p>.</span><span class=n>STR5</span><span class=p>,</span><span class=mi>0</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=收集统计信息 class=headerLink><a href=#%e6%94%b6%e9%9b%86%e7%bb%9f%e8%ae%a1%e4%bf%a1%e6%81%af class=header-mark></a>收集统计信息</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>execute</span><span class=w> </span><span class=n>dbms_stats</span><span class=p>.</span><span class=n>gather_table_stats</span><span class=p>(</span><span class=n>ownname</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s1>&#39;owner&#39;</span><span class=p>,</span><span class=n>tabname</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s1>&#39;table_name&#39;</span><span class=w> </span><span class=p>,</span><span class=n>estimate_percent</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=p>,</span><span class=n>method_opt</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s1>&#39;for all indexed columns&#39;</span><span class=w> </span><span class=p>,</span><span class=k>cascade</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=k>true</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=触发器 class=headerLink><a href=#%e8%a7%a6%e5%8f%91%e5%99%a8 class=header-mark></a>触发器</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>alter</span><span class=w> </span><span class=k>trigger</span><span class=w> </span><span class=n>xx_trigger</span><span class=w> </span><span class=n>disable</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>trigger</span><span class=w> </span><span class=n>xx_trigger</span><span class=w> </span><span class=n>enable</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=索引 class=headerLink><a href=#%e7%b4%a2%e5%bc%95 class=header-mark></a>索引</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>快速创建索引</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>index</span><span class=w> </span><span class=n>idx_table_a</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>table_a</span><span class=p>(</span><span class=err>字段</span><span class=n>a</span><span class=p>,</span><span class=err>字段</span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=n>nologging</span><span class=w> </span><span class=n>parallel</span><span class=w>  </span><span class=mi>4</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=重建所有索引 class=headerLink><a href=#%e9%87%8d%e5%bb%ba%e6%89%80%e6%9c%89%e7%b4%a2%e5%bc%95 class=header-mark></a>重建所有索引</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>declare</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>STR</span><span class=w> </span><span class=n>VARCHAR2</span><span class=p>(</span><span class=mi>400</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>begin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- 重建Oracle索引
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>  </span><span class=k>FOR</span><span class=w> </span><span class=n>TMP_IDX</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>TABLESPACE_NAME</span><span class=p>,</span><span class=w> </span><span class=k>OWNER</span><span class=p>,</span><span class=w> </span><span class=k>TABLE_NAME</span><span class=p>,</span><span class=w> </span><span class=n>INDEX_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>FROM</span><span class=w> </span><span class=n>ALL_INDEXES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                   </span><span class=k>WHERE</span><span class=w> </span><span class=k>OWNER</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;HNACMS&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                     </span><span class=k>AND</span><span class=w> </span><span class=k>temporary</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;N&#39;</span><span class=w>     
</span></span></span><span class=line><span class=cl><span class=w>                     </span><span class=c1>--AND TABLE_NAME = &#39;K_TASK&#39;              
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>                     </span><span class=c1>--AND TABLESPACE_NAME &lt;&gt; &#39;HNACMS_INDX&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>                   </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>TABLESPACE_NAME</span><span class=p>,</span><span class=w> </span><span class=k>TABLE_NAME</span><span class=p>)</span><span class=w> </span><span class=n>LOOP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>STR</span><span class=w> </span><span class=p>:</span><span class=o>=</span><span class=w> </span><span class=s1>&#39;ALTER INDEX &#39;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>TMP_IDX</span><span class=p>.</span><span class=k>OWNER</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s1>&#39;.&#39;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>TMP_IDX</span><span class=p>.</span><span class=n>INDEX_NAME</span><span class=w> </span><span class=o>||</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=s1>&#39; Rebuild Tablespace HNACMS_INDX&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>EXECUTE</span><span class=w> </span><span class=k>IMMEDIATE</span><span class=w> </span><span class=n>STR</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>END</span><span class=w> </span><span class=n>LOOP</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>end</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=日志切换时间 class=headerLink><a href=#%e6%97%a5%e5%bf%97%e5%88%87%e6%8d%a2%e6%97%b6%e9%97%b4 class=header-mark></a>日志切换时间</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w>  </span><span class=n>b</span><span class=p>.</span><span class=n>SEQUENCE</span><span class=o>#</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>b</span><span class=p>.</span><span class=n>FIRST_TIME</span><span class=p>,</span><span class=n>a</span><span class=p>.</span><span class=n>SEQUENCE</span><span class=o>#</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>a</span><span class=p>.</span><span class=n>FIRST_TIME</span><span class=p>,</span><span class=n>round</span><span class=p>(((</span><span class=n>a</span><span class=p>.</span><span class=n>FIRST_TIME</span><span class=o>-</span><span class=n>b</span><span class=p>.</span><span class=n>FIRST_TIME</span><span class=p>)</span><span class=o>*</span><span class=mi>24</span><span class=p>)</span><span class=o>*</span><span class=mi>60</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>v$log_history</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=n>v$log_history</span><span class=w> </span><span class=n>b</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>SEQUENCE</span><span class=o>#=</span><span class=n>b</span><span class=p>.</span><span class=n>SEQUENCE</span><span class=o>#+</span><span class=mi>1</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>and</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>THREAD</span><span class=o>#=</span><span class=mi>1</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>SEQUENCE</span><span class=o>#</span><span class=w> </span><span class=k>desc</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=删除操作 class=headerLink><a href=#%e5%88%a0%e9%99%a4%e6%93%8d%e4%bd%9c class=header-mark></a>删除操作</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>加速插入</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=n>nologging</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=cm>/*+append*/</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>,</span><span class=k>c</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>,</span><span class=k>c</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>xxx</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>批量删除</span><span class=p>.</span><span class=err>根据时间排序</span><span class=p>,</span><span class=mi>1000</span><span class=err>条</span><span class=n>commmit</span><span class=err>一次</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>declare</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>cursor</span><span class=w> </span><span class=p>[</span><span class=n>del_cursor</span><span class=p>]</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>rowid</span><span class=w> </span><span class=n>row_id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>[</span><span class=k>table_name</span><span class=p>]</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>rowid</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>begin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=n>v_cusor</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=p>[</span><span class=n>del_cursor</span><span class=p>]</span><span class=w> </span><span class=n>loop</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>v_cusor</span><span class=p>.[</span><span class=n>time_stamp</span><span class=p>]</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>to_date</span><span class=p>(</span><span class=s1>&#39;2014-01-01&#39;</span><span class=p>,</span><span class=s1>&#39;yyyy-mm-dd&#39;</span><span class=p>)</span><span class=w> </span><span class=k>then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>delete</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>[</span><span class=k>table_name</span><span class=p>]</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>rowid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v_cusor</span><span class=p>.</span><span class=n>row_id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>end</span><span class=w> </span><span class=k>if</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=k>mod</span><span class=p>([</span><span class=n>del_cursor</span><span class=p>]</span><span class=o>%</span><span class=n>rowcount</span><span class=p>,</span><span class=mi>1000</span><span class=p>)</span><span class=o>=</span><span class=mi>0</span><span class=w> </span><span class=k>then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>commit</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>end</span><span class=w> </span><span class=k>if</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>end</span><span class=w> </span><span class=n>loop</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>commit</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>end</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>两表数据同步</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MERGE</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>t_canhe_family</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=k>USING</span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>a1</span><span class=p>.</span><span class=n>family_id</span><span class=p>,</span><span class=n>a1</span><span class=p>.</span><span class=n>account_money</span><span class=p>,</span><span class=n>a1</span><span class=p>.</span><span class=n>balance</span><span class=p>,</span><span class=n>a1</span><span class=p>.</span><span class=n>remaining_money</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>t_canhe_family_bak20161121</span><span class=w> </span><span class=n>a1</span><span class=p>)</span><span class=w> </span><span class=n>tt</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=p>(</span><span class=n>tt</span><span class=p>.</span><span class=n>family_id</span><span class=o>=</span><span class=n>t1</span><span class=p>.</span><span class=n>family_id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>when</span><span class=w> </span><span class=n>matched</span><span class=w> </span><span class=k>then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>update</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=n>t1</span><span class=p>.</span><span class=n>account_money</span><span class=o>=</span><span class=n>tt</span><span class=p>.</span><span class=n>account_money</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>t1</span><span class=p>.</span><span class=n>balance</span><span class=o>=</span><span class=n>tt</span><span class=p>.</span><span class=n>balance</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>t1</span><span class=p>.</span><span class=n>remaining_money</span><span class=o>=</span><span class=n>tt</span><span class=p>.</span><span class=n>remaining_money</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=sql-优化 class=headerLink><a href=#sql-%e4%bc%98%e5%8c%96 class=header-mark></a>sql 优化</h3><h4 id=查看执行计划 class=headerLink><a href=#%e6%9f%a5%e7%9c%8b%e6%89%a7%e8%a1%8c%e8%ae%a1%e5%88%92 class=header-mark></a>查看执行计划</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=cm>/*+ gather_plan_statistics */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>*</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>from</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>table</span><span class=p>(</span><span class=n>dbms_xplan</span><span class=p>.</span><span class=n>display_cursor</span><span class=p>(</span><span class=n>NVL</span><span class=p>(</span><span class=s1>&#39;ajkqn4733r2qx&#39;</span><span class=p>,</span><span class=k>NULL</span><span class=p>),</span><span class=k>NULL</span><span class=p>,</span><span class=s1>&#39;ALL ALLSTATS LAST PEEKED_BINDS cost partition -projection -outline&#39;</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=查看-session-执行的-sql class=headerLink><a href=#%e6%9f%a5%e7%9c%8b-session-%e6%89%a7%e8%a1%8c%e7%9a%84-sql class=header-mark></a>查看 session 执行的 sql</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>c</span><span class=p>.</span><span class=n>spid</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>b</span><span class=p>.</span><span class=n>sql_text</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>a</span><span class=p>.</span><span class=n>sid</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>a</span><span class=p>.</span><span class=nb>serial</span><span class=o>#</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>osuser</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>machine</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>v$session</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=n>v$sqlarea</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=p>,</span><span class=n>v$process</span><span class=w> </span><span class=k>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>sql_address</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>address</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>paddr</span><span class=o>=</span><span class=k>c</span><span class=p>.</span><span class=n>addr</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>spid</span><span class=o>=&amp;</span><span class=n>pid</span><span class=p>;</span><span class=w> 
</span></span></span></code></pre></td></tr></table></div></div><h4 id=sql-tuning class=headerLink><a href=#sql-tuning class=header-mark></a>sql-tuning</h4><p>创建并执行 <code>tuning</code> 任务</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DECLARE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>my_task_name</span><span class=w> </span><span class=n>VARCHAR2</span><span class=p>(</span><span class=mi>300</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>my_sqltext</span><span class=w>   </span><span class=k>CLOB</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>my_sqltext</span><span class=w> </span><span class=p>:</span><span class=o>=</span><span class=w> </span><span class=s1>&#39;select
</span></span></span><span class=line><span class=cl><span class=s1>a.join_year,a.&#34;FAMILY_INFO_ID&#34;,a.&#34;FAMILY_NO&#34;,a.&#34;CARD_NO&#34;,a.&#34;FAMILY_NO&#34; as BOOK_NO ,a.&#34;CENTER_NO&#34;,a.&#34;AREA_NO&#34;,a.&#34;COUNTRY_NO&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>substr(a.&#34;FAMILY_NO&#34;,-4,4) as DOOR_NO,a.&#34;MASTER_NO&#34;,a.&#34;ADDRESS&#34;,a.&#34;POSTALCODE&#34;,a.&#34;PHONECODE&#34;,a.&#34;LINKMAN&#34;,a.&#34;EMAIL&#34;,a.&#34;POPULATION&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>a.&#34;FARMER&#34;,a.&#34;FARMER_STAY&#34;,a.&#34;JOIN_PROP&#34;,a.&#34;DOOR_PROP&#34;,a.&#34;RPR_TYPE&#34;,a.&#34;INOUT_FLAG&#34;,a.&#34;INOUT_DATE&#34;,a.&#34;INOUT_REASON&#34;,a.&#34;SALVATION&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>a.&#34;REGISTER&#34;,a.&#34;REGISTER_DATE&#34;,a.&#34;BOOK_STATE&#34;,a.&#34;CARD_STATE&#34;,a.&#34;FAMILY_STATE&#34;,a.&#34;AUDI_MAN&#34;,a.&#34;AUDI_STATE&#34;,a.&#34;AUDI_TIME&#34;,a.&#34;UPDATE_TIME&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>a.&#34;UPDATE_MAN&#34;,a.&#34;CREATE_TIME&#34;,a.&#34;CREATE_MAN&#34;,a.&#34;COMMENTS&#34;,a.&#34;IS_DEL&#34;,a.&#34;FRONT_STATE_D301&#34;,a.&#34;STR1&#34;,a.&#34;STR2&#34;,a.&#34;STR3&#34;,a.&#34;STR4&#34;,a.&#34;STR5&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>a.&#34;ZHEN_NO&#34;,a.&#34;CUN_NO&#34;,a.&#34;MASTER_NAME&#34;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>from T_NH_CANHE_FAMILYS a
</span></span></span><span class=line><span class=cl><span class=s1>where  a.is_del=1
</span></span></span><span class=line><span class=cl><span class=s1>and exists (select 1 from t_nh_dict_area x where a.country_no=x.countrycode and x.state=1)&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>my_task_name</span><span class=w> </span><span class=p>:</span><span class=o>=</span><span class=w> </span><span class=n>DBMS_SQLTUNE</span><span class=p>.</span><span class=n>CREATE_TUNING_TASK</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>               </span><span class=n>sql_text</span><span class=w>    </span><span class=o>=&gt;</span><span class=w> </span><span class=n>my_sqltext</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>               </span><span class=n>user_name</span><span class=w>   </span><span class=o>=&gt;</span><span class=w> </span><span class=s1>&#39;XIANGXI&#39;</span><span class=p>,</span><span class=w>   </span><span class=c1>-- 必须大写
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>               </span><span class=k>scope</span><span class=w>       </span><span class=o>=&gt;</span><span class=w> </span><span class=s1>&#39;COMPREHENSIVE&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>               </span><span class=n>time_limit</span><span class=w>  </span><span class=o>=&gt;</span><span class=w> </span><span class=mi>20</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>               </span><span class=n>task_name</span><span class=w>   </span><span class=o>=&gt;</span><span class=w> </span><span class=s1>&#39;tuning_sql_test&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>               </span><span class=n>description</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s1>&#39;Task to tune a query on a specified table&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>DBMS_SQLTUNE</span><span class=p>.</span><span class=n>EXECUTE_TUNING_TASK</span><span class=p>(</span><span class=w> </span><span class=n>task_name</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s1>&#39;tuning_sql_test&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>查看具体内容:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>dbms_sqltune</span><span class=p>.</span><span class=n>report_tuning_task</span><span class=p>(</span><span class=s1>&#39;tuning_sql_test&#39;</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>dual</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>使用完毕后删除:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>//</span><span class=n>sys</span><span class=err>用户删除</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>delete</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>dba_advisor_tasks</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>task_name</span><span class=w> </span><span class=o>=</span><span class=s1>&#39;tuning_sql_test&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=生成-awr class=headerLink><a href=#%e7%94%9f%e6%88%90-awr class=header-mark></a>生成 AWR</h2><p>SQL 路径在 <code>oracle_home/rdbms/admin/awrrpt.sql</code>,可以参考 <a href=http://blog.itpub.net/17203031/viewspace-700471/ target=_blank rel="noopener noreferrer">手工生成AWR报告方法记录_ITPUB博客</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>sqlplus</span> <span class=n>sys</span><span class=p>/</span><span class=n>oracle</span> <span class=n>as</span> <span class=n>sysdba</span> <span class=p>/</span><span class=n>nolog</span>
</span></span><span class=line><span class=cl><span class=nv>@oracle_home</span><span class=p>/</span><span class=n>rdbms</span><span class=p>/</span><span class=n>admin</span><span class=p>/</span><span class=n>awrrpt</span><span class=p>.</span><span class=py>sql</span>
</span></span><span class=line><span class=cl><span class=c># 按照提示输入即可</span>
</span></span><span class=line><span class=cl><span class=c># 其中文件名，可以填好路径。方便后面使用</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=常用图表 class=headerLink><a href=#%e5%b8%b8%e7%94%a8%e5%9b%be%e8%a1%a8 class=header-mark></a>常用图表</h2><ul><li>数据文件: <code>dba_data_file</code></li><li>临时表空间: <code>dba_temp_file</code></li><li>数据库使用的 directory 路径: <code>dba_directories</code></li><li>会话: <code>v$ssesion</code>. 其中 <code>sid,serial#</code> 用于杀死会话. <code>paddr</code> 用于关联 <code>v$proccess的addr</code>,关闭系统进程.</li><li>进程: <code>v$proccess</code>. 其中 <code>spid</code> 用 <code>kill -9</code> 杀死进程. <code>addr</code> 管理 <code>v$ssesion</code></li><li>SQL 文本: <code>v$sqlarea</code>. <code>sql_id,hash_value</code> 用于锁定 sql. <code>sql_fulltext</code> 全部 sql 语句，不会因为太长而截断</li><li>查看所有的 dblink: <code>dba_db_links</code></li><li>空闲表空间: <code>dba_free_space</code></li><li>分区表视图:
<code>ALL_PART_TABLES</code> 通过 table_name，找到分区表的概况信息.
<code>dba_tab_subpartitions</code> 分区表的详细信息 其中有分区名、子分区名</li><li>分区表查询
select * from table partition (分区名)
Select * from table subpartition (子分区名)</li><li>约束视图: <code>dba_constraints</code></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2023-08-16</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><button title="分享到 Twitter" data-sharer=twitter data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/oracle-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/ data-title=oracle-使用技巧 data-hashtags=blog,oracle><span class="fab fa-twitter fa-fw"></span></button><button title="分享到 Facebook" data-sharer=facebook data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/oracle-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/ data-hashtag=blog><span class="fab fa-facebook-square fa-fw"></span></button><button title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/oracle-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/ data-title=oracle-使用技巧 data-web><span class="fab fa-whatsapp fa-fw"></span></button><button title="分享到 Line" data-sharer=line data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/oracle-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/ data-title=oracle-使用技巧><span data-svg-src=/lib/simple-icons/icons/line.min.svg></span></button><button title="分享到 微博" data-sharer=weibo data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/oracle-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/ data-title=oracle-使用技巧><span class="fab fa-weibo fa-fw"></span></button><button title="分享到 Myspace" data-sharer=myspace data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/oracle-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/ data-title=oracle-使用技巧 data-description="因为以前的公司是用 [[笔记/point/oracle|oracle]],所以也记录了不少的命令. 记录一下后续使用."><span data-svg-src=/lib/simple-icons/icons/myspace.min.svg></span></button><button title="分享到 Blogger" data-sharer=blogger data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/oracle-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/ data-title=oracle-使用技巧 data-description="因为以前的公司是用 [[笔记/point/oracle|oracle]],所以也记录了不少的命令. 记录一下后续使用."><span class="fab fa-blogger fa-fw"></span></button><button title="分享到 Evernote" data-sharer=evernote data-url=https://kentxxq.com/posts/%E7%AC%94%E8%AE%B0/oracle-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/ data-title=oracle-使用技巧><span class="fab fa-evernote fa-fw"></span></button></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/blog/>blog</a>,&nbsp;<a href=/tags/oracle/>oracle</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/%E7%AC%94%E8%AE%B0/point/redis/ class=prev rel=prev title=redis><i class="fas fa-angle-left fa-fw"></i>redis</a>
<a href=/posts/%E7%AC%94%E8%AE%B0/point/oracle/ class=next rel=next title=oracle>oracle<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>1993 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://kentxxq.com target=_blank rel="noopener noreferrer">kentxxq</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a> | <a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=43010402000934"><img src=/备案图标.png style=display:inline-block>湘公网安备 43010402000934号</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a target=_blank href=https://beian.miit.gov.cn>湘ICP备2021002319号-1</a></span></div><div class=footer-line></div><div class=footer-line></div></div><script>"serviceWorker"in navigator&&(navigator.serviceWorker.register("/sw.min.js",{scope:"/"}).then(function(){}),navigator.serviceWorker.ready.then(function(){}))</script></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/katex/copy-tex.min.css><noscript><link rel=stylesheet href=/lib/katex/copy-tex.min.css></noscript><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:18},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:50,threshold:.3,type:"fuse",useExtendedSearch:!1},sharerjs:!0,twemoji:!0}</script><script type=text/javascript src=/lib/twemoji/twemoji.min.js defer></script><script type=text/javascript src=/js/twemoji.min.js defer></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/js/katex.min.js defer></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-NLLDC353PJ",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-NLLDC353PJ" async></script></div></body></html>